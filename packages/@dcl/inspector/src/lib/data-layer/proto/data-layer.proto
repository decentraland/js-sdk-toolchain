syntax = "proto3";

message Empty {}

// TODO: Maybe when we implement the list of undo/redo available we dont need this.
message UndoRedoResponse {
  string type = 1;
}

message CrdtStreamMessage {
  bytes data = 1;
}

message AssetData {
  bytes data = 1;
}

message Asset {
  string path = 1;
}

message AssetCatalogResponse {
  string base_path = 1;
  repeated Asset assets = 2;
}

message ImportAssetRequest {
  string base_path = 1;
  string asset_package_name = 2;
  map<string, bytes> content = 3;
}

message UpdateValue {
  uint32 entity_id = 1;
  uint32 component_id = 2;
  bytes data = 3;
}

message DeleteEntity {
  uint32 entity_id = 1;
}

message DispatchOperation {
  oneof operation {
    UpdateValue update_value = 1;
    DeleteEntity delete_entity = 2;
  }
}

service DataService {
  rpc Dispatch(DispatchOperation) returns (Empty) {}
  rpc CrdtStream(stream CrdtStreamMessage) returns (stream CrdtStreamMessage) {}
  rpc Undo(Empty) returns (UndoRedoResponse) {}
  rpc Redo(Empty) returns (UndoRedoResponse) {}

  rpc GetAssetCatalog(Empty) returns (AssetCatalogResponse) {}
  rpc GetAssetData(Asset) returns (AssetData) {}
  rpc ImportAsset(ImportAssetRequest) returns (Empty) {}
}