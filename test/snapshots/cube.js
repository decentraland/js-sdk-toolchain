"use strict";var EngineApi=require("~system/EngineApi"),commonjsGlobal="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},minimal$1={exports:{}},indexMinimal={},minimal={},aspromise,hasRequiredAspromise;function requireAspromise(){if(hasRequiredAspromise)return aspromise;return hasRequiredAspromise=1,aspromise=function(e,t){var r=new Array(arguments.length-1),n=0,i=2,o=!0;for(;i<arguments.length;)r[n++]=arguments[i++];return new Promise((function(i,s){r[n]=function(e){if(o)if(o=!1,e)s(e);else{for(var t=new Array(arguments.length-1),r=0;r<t.length;)t[r++]=arguments[r];i.apply(null,t)}};try{e.apply(t||null,r)}catch(e){o&&(o=!1,s(e))}}))},aspromise}var base64={},hasRequiredBase64,eventemitter,hasRequiredEventemitter,float,hasRequiredFloat,inquire_1,hasRequiredInquire;function requireBase64(){return hasRequiredBase64||(hasRequiredBase64=1,function(e){var t=e;t.length=function(e){var t=e.length;if(!t)return 0;for(var r=0;--t%4>1&&"="===e.charAt(t);)++r;return Math.ceil(3*e.length)/4-r};for(var r=new Array(64),n=new Array(123),i=0;i<64;)n[r[i]=i<26?i+65:i<52?i+71:i<62?i-4:i-59|43]=i++;t.encode=function(e,t,n){for(var i,o=null,s=[],a=0,u=0;t<n;){var c=e[t++];switch(u){case 0:s[a++]=r[c>>2],i=(3&c)<<4,u=1;break;case 1:s[a++]=r[i|c>>4],i=(15&c)<<2,u=2;break;case 2:s[a++]=r[i|c>>6],s[a++]=r[63&c],u=0}a>8191&&((o||(o=[])).push(String.fromCharCode.apply(String,s)),a=0)}return u&&(s[a++]=r[i],s[a++]=61,1===u&&(s[a++]=61)),o?(a&&o.push(String.fromCharCode.apply(String,s.slice(0,a))),o.join("")):String.fromCharCode.apply(String,s.slice(0,a))};var o="invalid encoding";t.decode=function(e,t,r){for(var i,s=r,a=0,u=0;u<e.length;){var c=e.charCodeAt(u++);if(61===c&&a>1)break;if(void 0===(c=n[c]))throw Error(o);switch(a){case 0:i=c,a=1;break;case 1:t[r++]=i<<2|(48&c)>>4,i=c,a=2;break;case 2:t[r++]=(15&i)<<4|(60&c)>>2,i=c,a=3;break;case 3:t[r++]=(3&i)<<6|c,a=0}}if(1===a)throw Error(o);return r-s},t.test=function(e){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)}}(base64)),base64}function requireEventemitter(){if(hasRequiredEventemitter)return eventemitter;function e(){this._listeners={}}return hasRequiredEventemitter=1,eventemitter=e,e.prototype.on=function(e,t,r){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:t,ctx:r||this}),this},e.prototype.off=function(e,t){if(void 0===e)this._listeners={};else if(void 0===t)this._listeners[e]=[];else for(var r=this._listeners[e],n=0;n<r.length;)r[n].fn===t?r.splice(n,1):++n;return this},e.prototype.emit=function(e){var t=this._listeners[e];if(t){for(var r=[],n=1;n<arguments.length;)r.push(arguments[n++]);for(n=0;n<t.length;)t[n].fn.apply(t[n++].ctx,r)}return this},eventemitter}function requireFloat(){if(hasRequiredFloat)return float;function e(e){return"undefined"!=typeof Float32Array?function(){var t=new Float32Array([-0]),r=new Uint8Array(t.buffer),n=128===r[3];function i(e,n,i){t[0]=e,n[i]=r[0],n[i+1]=r[1],n[i+2]=r[2],n[i+3]=r[3]}function o(e,n,i){t[0]=e,n[i]=r[3],n[i+1]=r[2],n[i+2]=r[1],n[i+3]=r[0]}function s(e,n){return r[0]=e[n],r[1]=e[n+1],r[2]=e[n+2],r[3]=e[n+3],t[0]}function a(e,n){return r[3]=e[n],r[2]=e[n+1],r[1]=e[n+2],r[0]=e[n+3],t[0]}e.writeFloatLE=n?i:o,e.writeFloatBE=n?o:i,e.readFloatLE=n?s:a,e.readFloatBE=n?a:s}():function(){function o(e,t,r,n){var i=t<0?1:0;if(i&&(t=-t),0===t)e(1/t>0?0:2147483648,r,n);else if(isNaN(t))e(2143289344,r,n);else if(t>34028234663852886e22)e((i<<31|2139095040)>>>0,r,n);else if(t<11754943508222875e-54)e((i<<31|Math.round(t/1401298464324817e-60))>>>0,r,n);else{var o=Math.floor(Math.log(t)/Math.LN2);e((i<<31|o+127<<23|8388607&Math.round(t*Math.pow(2,-o)*8388608))>>>0,r,n)}}function s(e,t,r){var n=e(t,r),i=2*(n>>31)+1,o=n>>>23&255,s=8388607&n;return 255===o?s?NaN:i*(1/0):0===o?1401298464324817e-60*i*s:i*Math.pow(2,o-150)*(s+8388608)}e.writeFloatLE=o.bind(null,t),e.writeFloatBE=o.bind(null,r),e.readFloatLE=s.bind(null,n),e.readFloatBE=s.bind(null,i)}(),"undefined"!=typeof Float64Array?function(){var t=new Float64Array([-0]),r=new Uint8Array(t.buffer),n=128===r[7];function i(e,n,i){t[0]=e,n[i]=r[0],n[i+1]=r[1],n[i+2]=r[2],n[i+3]=r[3],n[i+4]=r[4],n[i+5]=r[5],n[i+6]=r[6],n[i+7]=r[7]}function o(e,n,i){t[0]=e,n[i]=r[7],n[i+1]=r[6],n[i+2]=r[5],n[i+3]=r[4],n[i+4]=r[3],n[i+5]=r[2],n[i+6]=r[1],n[i+7]=r[0]}function s(e,n){return r[0]=e[n],r[1]=e[n+1],r[2]=e[n+2],r[3]=e[n+3],r[4]=e[n+4],r[5]=e[n+5],r[6]=e[n+6],r[7]=e[n+7],t[0]}function a(e,n){return r[7]=e[n],r[6]=e[n+1],r[5]=e[n+2],r[4]=e[n+3],r[3]=e[n+4],r[2]=e[n+5],r[1]=e[n+6],r[0]=e[n+7],t[0]}e.writeDoubleLE=n?i:o,e.writeDoubleBE=n?o:i,e.readDoubleLE=n?s:a,e.readDoubleBE=n?a:s}():function(){function o(e,t,r,n,i,o){var s=n<0?1:0;if(s&&(n=-n),0===n)e(0,i,o+t),e(1/n>0?0:2147483648,i,o+r);else if(isNaN(n))e(0,i,o+t),e(2146959360,i,o+r);else if(n>17976931348623157e292)e(0,i,o+t),e((s<<31|2146435072)>>>0,i,o+r);else{var a;if(n<22250738585072014e-324)e((a=n/5e-324)>>>0,i,o+t),e((s<<31|a/4294967296)>>>0,i,o+r);else{var u=Math.floor(Math.log(n)/Math.LN2);1024===u&&(u=1023),e(4503599627370496*(a=n*Math.pow(2,-u))>>>0,i,o+t),e((s<<31|u+1023<<20|1048576*a&1048575)>>>0,i,o+r)}}}function s(e,t,r,n,i){var o=e(n,i+t),s=e(n,i+r),a=2*(s>>31)+1,u=s>>>20&2047,c=4294967296*(1048575&s)+o;return 2047===u?c?NaN:a*(1/0):0===u?5e-324*a*c:a*Math.pow(2,u-1075)*(c+4503599627370496)}e.writeDoubleLE=o.bind(null,t,0,4),e.writeDoubleBE=o.bind(null,r,4,0),e.readDoubleLE=s.bind(null,n,0,4),e.readDoubleBE=s.bind(null,i,4,0)}(),e}function t(e,t,r){t[r]=255&e,t[r+1]=e>>>8&255,t[r+2]=e>>>16&255,t[r+3]=e>>>24}function r(e,t,r){t[r]=e>>>24,t[r+1]=e>>>16&255,t[r+2]=e>>>8&255,t[r+3]=255&e}function n(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0}function i(e,t){return(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])>>>0}return hasRequiredFloat=1,float=e(e)}function requireInquire(){if(hasRequiredInquire)return inquire_1;function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(e){}return null}return hasRequiredInquire=1,inquire_1=inquire,inquire_1}var utf8={},hasRequiredUtf8,pool_1,hasRequiredPool,longbits,hasRequiredLongbits,hasRequiredMinimal$1,writer,hasRequiredWriter,writer_buffer,hasRequiredWriter_buffer,reader,hasRequiredReader,reader_buffer,hasRequiredReader_buffer;function requireUtf8(){return hasRequiredUtf8||(hasRequiredUtf8=1,function(e){var t=e;t.length=function(e){for(var t=0,r=0,n=0;n<e.length;++n)(r=e.charCodeAt(n))<128?t+=1:r<2048?t+=2:55296==(64512&r)&&56320==(64512&e.charCodeAt(n+1))?(++n,t+=4):t+=3;return t},t.read=function(e,t,r){if(r-t<1)return"";for(var n,i=null,o=[],s=0;t<r;)(n=e[t++])<128?o[s++]=n:n>191&&n<224?o[s++]=(31&n)<<6|63&e[t++]:n>239&&n<365?(n=((7&n)<<18|(63&e[t++])<<12|(63&e[t++])<<6|63&e[t++])-65536,o[s++]=55296+(n>>10),o[s++]=56320+(1023&n)):o[s++]=(15&n)<<12|(63&e[t++])<<6|63&e[t++],s>8191&&((i||(i=[])).push(String.fromCharCode.apply(String,o)),s=0);return i?(s&&i.push(String.fromCharCode.apply(String,o.slice(0,s))),i.join("")):String.fromCharCode.apply(String,o.slice(0,s))},t.write=function(e,t,r){for(var n,i,o=r,s=0;s<e.length;++s)(n=e.charCodeAt(s))<128?t[r++]=n:n<2048?(t[r++]=n>>6|192,t[r++]=63&n|128):55296==(64512&n)&&56320==(64512&(i=e.charCodeAt(s+1)))?(n=65536+((1023&n)<<10)+(1023&i),++s,t[r++]=n>>18|240,t[r++]=n>>12&63|128,t[r++]=n>>6&63|128,t[r++]=63&n|128):(t[r++]=n>>12|224,t[r++]=n>>6&63|128,t[r++]=63&n|128);return r-o}}(utf8)),utf8}function requirePool(){if(hasRequiredPool)return pool_1;return hasRequiredPool=1,pool_1=function(e,t,r){var n=r||8192,i=n>>>1,o=null,s=n;return function(r){if(r<1||r>i)return e(r);s+r>n&&(o=e(n),s=0);var a=t.call(o,s,s+=r);return 7&s&&(s=1+(7|s)),a}}}function requireLongbits(){if(hasRequiredLongbits)return longbits;hasRequiredLongbits=1,longbits=t;var e=requireMinimal$1();function t(e,t){this.lo=e>>>0,this.hi=t>>>0}var r=t.zero=new t(0,0);r.toNumber=function(){return 0},r.zzEncode=r.zzDecode=function(){return this},r.length=function(){return 1};var n=t.zeroHash="\0\0\0\0\0\0\0\0";t.fromNumber=function(e){if(0===e)return r;var n=e<0;n&&(e=-e);var i=e>>>0,o=(e-i)/4294967296>>>0;return n&&(o=~o>>>0,i=~i>>>0,++i>4294967295&&(i=0,++o>4294967295&&(o=0))),new t(i,o)},t.from=function(n){if("number"==typeof n)return t.fromNumber(n);if(e.isString(n)){if(!e.Long)return t.fromNumber(parseInt(n,10));n=e.Long.fromString(n)}return n.low||n.high?new t(n.low>>>0,n.high>>>0):r},t.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=1+~this.lo>>>0,r=~this.hi>>>0;return t||(r=r+1>>>0),-(t+4294967296*r)}return this.lo+4294967296*this.hi},t.prototype.toLong=function(t){return e.Long?new e.Long(0|this.lo,0|this.hi,Boolean(t)):{low:0|this.lo,high:0|this.hi,unsigned:Boolean(t)}};var i=String.prototype.charCodeAt;return t.fromHash=function(e){return e===n?r:new t((i.call(e,0)|i.call(e,1)<<8|i.call(e,2)<<16|i.call(e,3)<<24)>>>0,(i.call(e,4)|i.call(e,5)<<8|i.call(e,6)<<16|i.call(e,7)<<24)>>>0)},t.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},t.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this},t.prototype.zzDecode=function(){var e=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this},t.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,r=this.hi>>>24;return 0===r?0===t?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:r<128?9:10},longbits}function requireMinimal$1(){return hasRequiredMinimal$1||(hasRequiredMinimal$1=1,function(e){var t=minimal;function r(e,t,r){for(var n=Object.keys(t),i=0;i<n.length;++i)void 0!==e[n[i]]&&r||(e[n[i]]=t[n[i]]);return e}function n(e){function t(e,n){if(!(this instanceof t))return new t(e,n);Object.defineProperty(this,"message",{get:function(){return e}}),Error.captureStackTrace?Error.captureStackTrace(this,t):Object.defineProperty(this,"stack",{value:(new Error).stack||""}),n&&r(this,n)}return(t.prototype=Object.create(Error.prototype)).constructor=t,Object.defineProperty(t.prototype,"name",{get:function(){return e}}),t.prototype.toString=function(){return this.name+": "+this.message},t}t.asPromise=requireAspromise(),t.base64=requireBase64(),t.EventEmitter=requireEventemitter(),t.float=requireFloat(),t.inquire=requireInquire(),t.utf8=requireUtf8(),t.pool=requirePool(),t.LongBits=requireLongbits(),t.isNode=Boolean(void 0!==commonjsGlobal&&commonjsGlobal&&commonjsGlobal.process&&commonjsGlobal.process.versions&&commonjsGlobal.process.versions.node),t.global=t.isNode&&commonjsGlobal||"undefined"!=typeof self&&self||commonjsGlobal,t.emptyArray=Object.freeze?Object.freeze([]):[],t.emptyObject=Object.freeze?Object.freeze({}):{},t.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},t.isString=function(e){return"string"==typeof e||e instanceof String},t.isObject=function(e){return e&&"object"==typeof e},t.isset=t.isSet=function(e,t){var r=e[t];return!(null==r||!e.hasOwnProperty(t))&&("object"!=typeof r||(Array.isArray(r)?r.length:Object.keys(r).length)>0)},t.Buffer=function(){try{var e=t.inquire("buffer").Buffer;return e.prototype.utf8Write?e:null}catch(e){return null}}(),t._Buffer_from=null,t._Buffer_allocUnsafe=null,t.newBuffer=function(e){return"number"==typeof e?t.Buffer?t._Buffer_allocUnsafe(e):new t.Array(e):t.Buffer?t._Buffer_from(e):"undefined"==typeof Uint8Array?e:new Uint8Array(e)},t.Array="undefined"!=typeof Uint8Array?Uint8Array:Array,t.Long=t.global.dcodeIO&&t.global.dcodeIO.Long||t.global.Long||t.inquire("long"),t.key2Re=/^true|false|0|1$/,t.key32Re=/^-?(?:0|[1-9][0-9]*)$/,t.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,t.longToHash=function(e){return e?t.LongBits.from(e).toHash():t.LongBits.zeroHash},t.longFromHash=function(e,r){var n=t.LongBits.fromHash(e);return t.Long?t.Long.fromBits(n.lo,n.hi,r):n.toNumber(Boolean(r))},t.merge=r,t.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)},t.newError=n,t.ProtocolError=n("ProtocolError"),t.oneOfGetter=function(e){for(var t={},r=0;r<e.length;++r)t[e[r]]=1;return function(){for(var e=Object.keys(this),r=e.length-1;r>-1;--r)if(1===t[e[r]]&&void 0!==this[e[r]]&&null!==this[e[r]])return e[r]}},t.oneOfSetter=function(e){return function(t){for(var r=0;r<e.length;++r)e[r]!==t&&delete this[e[r]]}},t.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},t._configure=function(){var e=t.Buffer;e?(t._Buffer_from=e.from!==Uint8Array.from&&e.from||function(t,r){return new e(t,r)},t._Buffer_allocUnsafe=e.allocUnsafe||function(t){return new e(t)}):t._Buffer_from=t._Buffer_allocUnsafe=null}}()),minimal}function requireWriter(){if(hasRequiredWriter)return writer;hasRequiredWriter=1,writer=u;var e,t=requireMinimal$1(),r=t.LongBits,n=t.base64,i=t.utf8;function o(e,t,r){this.fn=e,this.len=t,this.next=void 0,this.val=r}function s(){}function a(e){this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}function u(){this.len=0,this.head=new o(s,0,0),this.tail=this.head,this.states=null}var c=function(){return t.Buffer?function(){return(u.create=function(){return new e})()}:function(){return new u}};function l(e,t,r){t[r]=255&e}function f(e,t){this.len=e,this.next=void 0,this.val=t}function d(e,t,r){for(;e.hi;)t[r++]=127&e.lo|128,e.lo=(e.lo>>>7|e.hi<<25)>>>0,e.hi>>>=7;for(;e.lo>127;)t[r++]=127&e.lo|128,e.lo=e.lo>>>7;t[r++]=e.lo}function h(e,t,r){t[r]=255&e,t[r+1]=e>>>8&255,t[r+2]=e>>>16&255,t[r+3]=e>>>24}u.create=c(),u.alloc=function(e){return new t.Array(e)},t.Array!==Array&&(u.alloc=t.pool(u.alloc,t.Array.prototype.subarray)),u.prototype._push=function(e,t,r){return this.tail=this.tail.next=new o(e,t,r),this.len+=t,this},f.prototype=Object.create(o.prototype),f.prototype.fn=function(e,t,r){for(;e>127;)t[r++]=127&e|128,e>>>=7;t[r]=e},u.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new f((e>>>=0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this},u.prototype.int32=function(e){return e<0?this._push(d,10,r.fromNumber(e)):this.uint32(e)},u.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)},u.prototype.uint64=function(e){var t=r.from(e);return this._push(d,t.length(),t)},u.prototype.int64=u.prototype.uint64,u.prototype.sint64=function(e){var t=r.from(e).zzEncode();return this._push(d,t.length(),t)},u.prototype.bool=function(e){return this._push(l,1,e?1:0)},u.prototype.fixed32=function(e){return this._push(h,4,e>>>0)},u.prototype.sfixed32=u.prototype.fixed32,u.prototype.fixed64=function(e){var t=r.from(e);return this._push(h,4,t.lo)._push(h,4,t.hi)},u.prototype.sfixed64=u.prototype.fixed64,u.prototype.float=function(e){return this._push(t.float.writeFloatLE,4,e)},u.prototype.double=function(e){return this._push(t.float.writeDoubleLE,8,e)};var p=t.Array.prototype.set?function(e,t,r){t.set(e,r)}:function(e,t,r){for(var n=0;n<e.length;++n)t[r+n]=e[n]};return u.prototype.bytes=function(e){var r=e.length>>>0;if(!r)return this._push(l,1,0);if(t.isString(e)){var i=u.alloc(r=n.length(e));n.decode(e,i,0),e=i}return this.uint32(r)._push(p,r,e)},u.prototype.string=function(e){var t=i.length(e);return t?this.uint32(t)._push(i.write,t,e):this._push(l,1,0)},u.prototype.fork=function(){return this.states=new a(this),this.head=this.tail=new o(s,0,0),this.len=0,this},u.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new o(s,0,0),this.len=0),this},u.prototype.ldelim=function(){var e=this.head,t=this.tail,r=this.len;return this.reset().uint32(r),r&&(this.tail.next=e.next,this.tail=t,this.len+=r),this},u.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),r=0;e;)e.fn(e.val,t,r),r+=e.len,e=e.next;return t},u._configure=function(t){e=t,u.create=c(),e._configure()},writer}function requireWriter_buffer(){if(hasRequiredWriter_buffer)return writer_buffer;hasRequiredWriter_buffer=1,writer_buffer=r;var e=requireWriter();(r.prototype=Object.create(e.prototype)).constructor=r;var t=requireMinimal$1();function r(){e.call(this)}function n(e,r,n){e.length<40?t.utf8.write(e,r,n):r.utf8Write?r.utf8Write(e,n):r.write(e,n)}return r._configure=function(){r.alloc=t._Buffer_allocUnsafe,r.writeBytesBuffer=t.Buffer&&t.Buffer.prototype instanceof Uint8Array&&"set"===t.Buffer.prototype.set.name?function(e,t,r){t.set(e,r)}:function(e,t,r){if(e.copy)e.copy(t,r,0,e.length);else for(var n=0;n<e.length;)t[r++]=e[n++]}},r.prototype.bytes=function(e){t.isString(e)&&(e=t._Buffer_from(e,"base64"));var n=e.length>>>0;return this.uint32(n),n&&this._push(r.writeBytesBuffer,n,e),this},r.prototype.string=function(e){var r=t.Buffer.byteLength(e);return this.uint32(r),r&&this._push(n,r,e),this},r._configure(),writer_buffer}function requireReader(){if(hasRequiredReader)return reader;hasRequiredReader=1,reader=o;var e,t=requireMinimal$1(),r=t.LongBits,n=t.utf8;function i(e,t){return RangeError("index out of range: "+e.pos+" + "+(t||1)+" > "+e.len)}function o(e){this.buf=e,this.pos=0,this.len=e.length}var s,a="undefined"!=typeof Uint8Array?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new o(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new o(e);throw Error("illegal buffer")},u=function(){return t.Buffer?function(r){return(o.create=function(r){return t.Buffer.isBuffer(r)?new e(r):a(r)})(r)}:a};function c(){var e=new r(0,0),t=0;if(!(this.len-this.pos>4)){for(;t<3;++t){if(this.pos>=this.len)throw i(this);if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(127&this.buf[this.pos++])<<7*t)>>>0,e}for(;t<4;++t)if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(127&this.buf[this.pos])<<28)>>>0,e.hi=(e.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return e;if(t=0,this.len-this.pos>4){for(;t<5;++t)if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}else for(;t<5;++t){if(this.pos>=this.len)throw i(this);if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}function l(e,t){return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0}function f(){if(this.pos+8>this.len)throw i(this,8);return new r(l(this.buf,this.pos+=4),l(this.buf,this.pos+=4))}return o.create=u(),o.prototype._slice=t.Array.prototype.subarray||t.Array.prototype.slice,o.prototype.uint32=(s=4294967295,function(){if(s=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128)return s;if(s=(s|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)return s;if(s=(s|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)return s;if(s=(s|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)return s;if(s=(s|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128)return s;if((this.pos+=5)>this.len)throw this.pos=this.len,i(this,10);return s}),o.prototype.int32=function(){return 0|this.uint32()},o.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(1&e)|0},o.prototype.bool=function(){return 0!==this.uint32()},o.prototype.fixed32=function(){if(this.pos+4>this.len)throw i(this,4);return l(this.buf,this.pos+=4)},o.prototype.sfixed32=function(){if(this.pos+4>this.len)throw i(this,4);return 0|l(this.buf,this.pos+=4)},o.prototype.float=function(){if(this.pos+4>this.len)throw i(this,4);var e=t.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e},o.prototype.double=function(){if(this.pos+8>this.len)throw i(this,4);var e=t.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e},o.prototype.bytes=function(){var e=this.uint32(),t=this.pos,r=this.pos+e;if(r>this.len)throw i(this,e);return this.pos+=e,Array.isArray(this.buf)?this.buf.slice(t,r):t===r?new this.buf.constructor(0):this._slice.call(this.buf,t,r)},o.prototype.string=function(){var e=this.bytes();return n.read(e,0,e.length)},o.prototype.skip=function(e){if("number"==typeof e){if(this.pos+e>this.len)throw i(this,e);this.pos+=e}else do{if(this.pos>=this.len)throw i(this)}while(128&this.buf[this.pos++]);return this},o.prototype.skipType=function(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(e=7&this.uint32());)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+e+" at offset "+this.pos)}return this},o._configure=function(r){e=r,o.create=u(),e._configure();var n=t.Long?"toLong":"toNumber";t.merge(o.prototype,{int64:function(){return c.call(this)[n](!1)},uint64:function(){return c.call(this)[n](!0)},sint64:function(){return c.call(this).zzDecode()[n](!1)},fixed64:function(){return f.call(this)[n](!0)},sfixed64:function(){return f.call(this)[n](!1)}})},reader}function requireReader_buffer(){if(hasRequiredReader_buffer)return reader_buffer;hasRequiredReader_buffer=1,reader_buffer=r;var e=requireReader();(r.prototype=Object.create(e.prototype)).constructor=r;var t=requireMinimal$1();function r(t){e.call(this,t)}return r._configure=function(){t.Buffer&&(r.prototype._slice=t.Buffer.prototype.slice)},r.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))},r._configure(),reader_buffer}var rpc={},service,hasRequiredService,hasRequiredRpc,roots,hasRequiredRoots,hasRequiredIndexMinimal,hasRequiredMinimal;function requireService(){if(hasRequiredService)return service;hasRequiredService=1,service=t;var e=requireMinimal$1();function t(t,r,n){if("function"!=typeof t)throw TypeError("rpcImpl must be a function");e.EventEmitter.call(this),this.rpcImpl=t,this.requestDelimited=Boolean(r),this.responseDelimited=Boolean(n)}return(t.prototype=Object.create(e.EventEmitter.prototype)).constructor=t,t.prototype.rpcCall=function t(r,n,i,o,s){if(!o)throw TypeError("request must be specified");var a=this;if(!s)return e.asPromise(t,a,r,n,i,o);if(a.rpcImpl)try{return a.rpcImpl(r,n[a.requestDelimited?"encodeDelimited":"encode"](o).finish(),(function(e,t){if(e)return a.emit("error",e,r),s(e);if(null!==t){if(!(t instanceof i))try{t=i[a.responseDelimited?"decodeDelimited":"decode"](t)}catch(e){return a.emit("error",e,r),s(e)}return a.emit("data",t,r),s(null,t)}a.end(!0)}))}catch(e){return a.emit("error",e,r),void setTimeout((function(){s(e)}),0)}else setTimeout((function(){s(Error("already ended"))}),0)},t.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this},service}function requireRpc(){return hasRequiredRpc||(hasRequiredRpc=1,function(e){e.Service=requireService()}(rpc)),rpc}function requireRoots(){return hasRequiredRoots?roots:(hasRequiredRoots=1,roots={})}function requireIndexMinimal(){return hasRequiredIndexMinimal||(hasRequiredIndexMinimal=1,function(e){var t=indexMinimal;function r(){t.util._configure(),t.Writer._configure(t.BufferWriter),t.Reader._configure(t.BufferReader)}t.build="minimal",t.Writer=requireWriter(),t.BufferWriter=requireWriter_buffer(),t.Reader=requireReader(),t.BufferReader=requireReader_buffer(),t.util=requireMinimal$1(),t.rpc=requireRpc(),t.roots=requireRoots(),t.configure=r,r()}()),indexMinimal}function requireMinimal(){return hasRequiredMinimal||(hasRequiredMinimal=1,minimal$1.exports=requireIndexMinimal()),minimal$1.exports}var minimalExports=requireMinimal();function createBasePBAnimator(){return{states:[]}}const PBAnimator={encode(e,t=minimalExports.Writer.create()){for(const r of e.states)PBAnimationState.encode(r,t.uint32(10).fork()).ldelim();return t},decode(e,t){const r=e instanceof minimalExports.Reader?e:new minimalExports.Reader(e);let n=void 0===t?r.len:r.pos+t;const i=createBasePBAnimator();for(;r.pos<n;){const e=r.uint32();if(e>>>3==1)i.states.push(PBAnimationState.decode(r,r.uint32()));else r.skipType(7&e)}return i}};function createBasePBAnimationState(){return{name:"",clip:"",playing:void 0,weight:void 0,speed:void 0,loop:void 0,shouldReset:void 0}}const PBAnimationState={encode:(e,t=minimalExports.Writer.create())=>(""!==e.name&&t.uint32(10).string(e.name),""!==e.clip&&t.uint32(18).string(e.clip),void 0!==e.playing&&t.uint32(24).bool(e.playing),void 0!==e.weight&&t.uint32(37).float(e.weight),void 0!==e.speed&&t.uint32(45).float(e.speed),void 0!==e.loop&&t.uint32(48).bool(e.loop),void 0!==e.shouldReset&&t.uint32(56).bool(e.shouldReset),t),decode(e,t){const r=e instanceof minimalExports.Reader?e:new minimalExports.Reader(e);let n=void 0===t?r.len:r.pos+t;const i=createBasePBAnimationState();for(;r.pos<n;){const e=r.uint32();switch(e>>>3){case 1:i.name=r.string();break;case 2:i.clip=r.string();break;case 3:i.playing=r.bool();break;case 4:i.weight=r.float();break;case 5:i.speed=r.float();break;case 6:i.loop=r.bool();break;case 7:i.shouldReset=r.bool();break;default:r.skipType(7&e)}}return i}},AnimatorSchema={COMPONENT_ID:1042,serialize(e,t){const r=PBAnimator.encode(e),n=new Uint8Array(r.finish(),0,r.len);t.writeBuffer(n,!1)},deserialize:e=>PBAnimator.decode(e.buffer(),e.remainingBytes()),create:()=>PBAnimator.decode(new Uint8Array)};function createBaseVector3(){return{x:0,y:0,z:0}}const Vector3={encode:(e,t=minimalExports.Writer.create())=>(0!==e.x&&t.uint32(13).float(e.x),0!==e.y&&t.uint32(21).float(e.y),0!==e.z&&t.uint32(29).float(e.z),t),decode(e,t){const r=e instanceof minimalExports.Reader?e:new minimalExports.Reader(e);let n=void 0===t?r.len:r.pos+t;const i=createBaseVector3();for(;r.pos<n;){const e=r.uint32();switch(e>>>3){case 1:i.x=r.float();break;case 2:i.y=r.float();break;case 3:i.z=r.float();break;default:r.skipType(7&e)}}return i}};var long,hasRequiredLong;function requireLong(){if(hasRequiredLong)return long;hasRequiredLong=1,long=t;var e=null;try{e=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(e){}function t(e,t,r){this.low=0|e,this.high=0|t,this.unsigned=!!r}function r(e){return!0===(e&&e.__isLong__)}Object.defineProperty(t.prototype,"__isLong__",{value:!0}),t.isLong=r;var n={},i={};function o(e,t){var r,o,s;return t?(s=0<=(e>>>=0)&&e<256)&&(o=i[e])?o:(r=a(e,(0|e)<0?-1:0,!0),s&&(i[e]=r),r):(s=-128<=(e|=0)&&e<128)&&(o=n[e])?o:(r=a(e,e<0?-1:0,!1),s&&(n[e]=r),r)}function s(e,t){if(isNaN(e))return t?g:m;if(t){if(e<0)return g;if(e>=d)return w}else{if(e<=-h)return M;if(e+1>=h)return E}return e<0?s(-e,t).neg():a(e%f|0,e/f|0,t)}function a(e,r,n){return new t(e,r,n)}t.fromInt=o,t.fromNumber=s,t.fromBits=a;var u=Math.pow;function c(e,t,r){if(0===e.length)throw Error("empty string");if("NaN"===e||"Infinity"===e||"+Infinity"===e||"-Infinity"===e)return m;if("number"==typeof t?(r=t,t=!1):t=!!t,(r=r||10)<2||36<r)throw RangeError("radix");var n;if((n=e.indexOf("-"))>0)throw Error("interior hyphen");if(0===n)return c(e.substring(1),t,r).neg();for(var i=s(u(r,8)),o=m,a=0;a<e.length;a+=8){var l=Math.min(8,e.length-a),f=parseInt(e.substring(a,a+l),r);if(l<8){var d=s(u(r,l));o=o.mul(d).add(s(f))}else o=(o=o.mul(i)).add(s(f))}return o.unsigned=t,o}function l(e,t){return"number"==typeof e?s(e,t):"string"==typeof e?c(e,t):a(e.low,e.high,"boolean"==typeof t?t:e.unsigned)}t.fromString=c,t.fromValue=l;var f=4294967296,d=f*f,h=d/2,p=o(1<<24),m=o(0);t.ZERO=m;var g=o(0,!0);t.UZERO=g;var y=o(1);t.ONE=y;var b=o(1,!0);t.UONE=b;var v=o(-1);t.NEG_ONE=v;var E=a(-1,2147483647,!1);t.MAX_VALUE=E;var w=a(-1,-1,!0);t.MAX_UNSIGNED_VALUE=w;var M=a(0,-2147483648,!1);t.MIN_VALUE=M;var T=t.prototype;return T.toInt=function(){return this.unsigned?this.low>>>0:this.low},T.toNumber=function(){return this.unsigned?(this.high>>>0)*f+(this.low>>>0):this.high*f+(this.low>>>0)},T.toString=function(e){if((e=e||10)<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(M)){var t=s(e),r=this.div(t),n=r.mul(t).sub(this);return r.toString(e)+n.toInt().toString(e)}return"-"+this.neg().toString(e)}for(var i=s(u(e,6),this.unsigned),o=this,a="";;){var c=o.div(i),l=(o.sub(c.mul(i)).toInt()>>>0).toString(e);if((o=c).isZero())return l+a;for(;l.length<6;)l="0"+l;a=""+l+a}},T.getHighBits=function(){return this.high},T.getHighBitsUnsigned=function(){return this.high>>>0},T.getLowBits=function(){return this.low},T.getLowBitsUnsigned=function(){return this.low>>>0},T.getNumBitsAbs=function(){if(this.isNegative())return this.eq(M)?64:this.neg().getNumBitsAbs();for(var e=0!=this.high?this.high:this.low,t=31;t>0&&0==(e&1<<t);t--);return 0!=this.high?t+33:t+1},T.isZero=function(){return 0===this.high&&0===this.low},T.eqz=T.isZero,T.isNegative=function(){return!this.unsigned&&this.high<0},T.isPositive=function(){return this.unsigned||this.high>=0},T.isOdd=function(){return 1==(1&this.low)},T.isEven=function(){return 0==(1&this.low)},T.equals=function(e){return r(e)||(e=l(e)),(this.unsigned===e.unsigned||this.high>>>31!=1||e.high>>>31!=1)&&(this.high===e.high&&this.low===e.low)},T.eq=T.equals,T.notEquals=function(e){return!this.eq(e)},T.neq=T.notEquals,T.ne=T.notEquals,T.lessThan=function(e){return this.comp(e)<0},T.lt=T.lessThan,T.lessThanOrEqual=function(e){return this.comp(e)<=0},T.lte=T.lessThanOrEqual,T.le=T.lessThanOrEqual,T.greaterThan=function(e){return this.comp(e)>0},T.gt=T.greaterThan,T.greaterThanOrEqual=function(e){return this.comp(e)>=0},T.gte=T.greaterThanOrEqual,T.ge=T.greaterThanOrEqual,T.compare=function(e){if(r(e)||(e=l(e)),this.eq(e))return 0;var t=this.isNegative(),n=e.isNegative();return t&&!n?-1:!t&&n?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1},T.comp=T.compare,T.negate=function(){return!this.unsigned&&this.eq(M)?M:this.not().add(y)},T.neg=T.negate,T.add=function(e){r(e)||(e=l(e));var t=this.high>>>16,n=65535&this.high,i=this.low>>>16,o=65535&this.low,s=e.high>>>16,u=65535&e.high,c=e.low>>>16,f=0,d=0,h=0,p=0;return h+=(p+=o+(65535&e.low))>>>16,d+=(h+=i+c)>>>16,f+=(d+=n+u)>>>16,f+=t+s,a((h&=65535)<<16|(p&=65535),(f&=65535)<<16|(d&=65535),this.unsigned)},T.subtract=function(e){return r(e)||(e=l(e)),this.add(e.neg())},T.sub=T.subtract,T.multiply=function(t){if(this.isZero())return m;if(r(t)||(t=l(t)),e)return a(e.mul(this.low,this.high,t.low,t.high),e.get_high(),this.unsigned);if(t.isZero())return m;if(this.eq(M))return t.isOdd()?M:m;if(t.eq(M))return this.isOdd()?M:m;if(this.isNegative())return t.isNegative()?this.neg().mul(t.neg()):this.neg().mul(t).neg();if(t.isNegative())return this.mul(t.neg()).neg();if(this.lt(p)&&t.lt(p))return s(this.toNumber()*t.toNumber(),this.unsigned);var n=this.high>>>16,i=65535&this.high,o=this.low>>>16,u=65535&this.low,c=t.high>>>16,f=65535&t.high,d=t.low>>>16,h=65535&t.low,g=0,y=0,b=0,v=0;return b+=(v+=u*h)>>>16,y+=(b+=o*h)>>>16,b&=65535,y+=(b+=u*d)>>>16,g+=(y+=i*h)>>>16,y&=65535,g+=(y+=o*d)>>>16,y&=65535,g+=(y+=u*f)>>>16,g+=n*h+i*d+o*f+u*c,a((b&=65535)<<16|(v&=65535),(g&=65535)<<16|(y&=65535),this.unsigned)},T.mul=T.multiply,T.divide=function(t){if(r(t)||(t=l(t)),t.isZero())throw Error("division by zero");var n,i,o;if(e)return this.unsigned||-2147483648!==this.high||-1!==t.low||-1!==t.high?a((this.unsigned?e.div_u:e.div_s)(this.low,this.high,t.low,t.high),e.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?g:m;if(this.unsigned){if(t.unsigned||(t=t.toUnsigned()),t.gt(this))return g;if(t.gt(this.shru(1)))return b;o=g}else{if(this.eq(M))return t.eq(y)||t.eq(v)?M:t.eq(M)?y:(n=this.shr(1).div(t).shl(1)).eq(m)?t.isNegative()?y:v:(i=this.sub(t.mul(n)),o=n.add(i.div(t)));if(t.eq(M))return this.unsigned?g:m;if(this.isNegative())return t.isNegative()?this.neg().div(t.neg()):this.neg().div(t).neg();if(t.isNegative())return this.div(t.neg()).neg();o=m}for(i=this;i.gte(t);){n=Math.max(1,Math.floor(i.toNumber()/t.toNumber()));for(var c=Math.ceil(Math.log(n)/Math.LN2),f=c<=48?1:u(2,c-48),d=s(n),h=d.mul(t);h.isNegative()||h.gt(i);)h=(d=s(n-=f,this.unsigned)).mul(t);d.isZero()&&(d=y),o=o.add(d),i=i.sub(h)}return o},T.div=T.divide,T.modulo=function(t){return r(t)||(t=l(t)),e?a((this.unsigned?e.rem_u:e.rem_s)(this.low,this.high,t.low,t.high),e.get_high(),this.unsigned):this.sub(this.div(t).mul(t))},T.mod=T.modulo,T.rem=T.modulo,T.not=function(){return a(~this.low,~this.high,this.unsigned)},T.and=function(e){return r(e)||(e=l(e)),a(this.low&e.low,this.high&e.high,this.unsigned)},T.or=function(e){return r(e)||(e=l(e)),a(this.low|e.low,this.high|e.high,this.unsigned)},T.xor=function(e){return r(e)||(e=l(e)),a(this.low^e.low,this.high^e.high,this.unsigned)},T.shiftLeft=function(e){return r(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?a(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):a(0,this.low<<e-32,this.unsigned)},T.shl=T.shiftLeft,T.shiftRight=function(e){return r(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?a(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):a(this.high>>e-32,this.high>=0?0:-1,this.unsigned)},T.shr=T.shiftRight,T.shiftRightUnsigned=function(e){if(r(e)&&(e=e.toInt()),0===(e&=63))return this;var t=this.high;return e<32?a(this.low>>>e|t<<32-e,t>>>e,this.unsigned):a(32===e?t:t>>>e-32,0,this.unsigned)},T.shru=T.shiftRightUnsigned,T.shr_u=T.shiftRightUnsigned,T.toSigned=function(){return this.unsigned?a(this.low,this.high,!1):this},T.toUnsigned=function(){return this.unsigned?this:a(this.low,this.high,!0)},T.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},T.toBytesLE=function(){var e=this.high,t=this.low;return[255&t,t>>>8&255,t>>>16&255,t>>>24,255&e,e>>>8&255,e>>>16&255,e>>>24]},T.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,255&e,t>>>24,t>>>16&255,t>>>8&255,255&t]},t.fromBytes=function(e,r,n){return n?t.fromBytesLE(e,r):t.fromBytesBE(e,r)},t.fromBytesLE=function(e,r){return new t(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,r)},t.fromBytesBE=function(e,r){return new t(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],r)},long}var longExports=requireLong();function createBaseColor3(){return{r:0,g:0,b:0}}const Color3={encode:(e,t=minimalExports.Writer.create())=>(0!==e.r&&t.uint32(13).float(e.r),0!==e.g&&t.uint32(21).float(e.g),0!==e.b&&t.uint32(29).float(e.b),t),decode(e,t){const r=e instanceof minimalExports.Reader?e:new minimalExports.Reader(e);let n=void 0===t?r.len:r.pos+t;const i=createBaseColor3();for(;r.pos<n;){const e=r.uint32();switch(e>>>3){case 1:i.r=r.float();break;case 2:i.g=r.float();break;case 3:i.b=r.float();break;default:r.skipType(7&e)}}return i}};var TextureWrapMode,TextureFilterMode;function createBaseTexture(){return{src:"",wrapMode:void 0,filterMode:void 0}}!function(e){e[e.TWM_REPEAT=0]="TWM_REPEAT",e[e.TWM_CLAMP=1]="TWM_CLAMP",e[e.TWM_MIRROR=2]="TWM_MIRROR",e[e.TWM_MIRROR_ONCE=3]="TWM_MIRROR_ONCE"}(TextureWrapMode||(TextureWrapMode={})),function(e){e[e.TFM_POINT=0]="TFM_POINT",e[e.TFM_BILINEAR=1]="TFM_BILINEAR",e[e.TFM_TRILINEAR=2]="TFM_TRILINEAR"}(TextureFilterMode||(TextureFilterMode={}));const Texture={encode:(e,t=minimalExports.Writer.create())=>(""!==e.src&&t.uint32(10).string(e.src),void 0!==e.wrapMode&&t.uint32(16).int32(e.wrapMode),void 0!==e.filterMode&&t.uint32(24).int32(e.filterMode),t),decode(e,t){const r=e instanceof minimalExports.Reader?e:new minimalExports.Reader(e);let n=void 0===t?r.len:r.pos+t;const i=createBaseTexture();for(;r.pos<n;){const e=r.uint32();switch(e>>>3){case 1:i.src=r.string();break;case 2:i.wrapMode=r.int32();break;case 3:i.filterMode=r.int32();break;default:r.skipType(7&e)}}return i}};function createBaseAvatarTexture(){return{userId:"",wrapMode:void 0,filterMode:void 0}}const AvatarTexture={encode:(e,t=minimalExports.Writer.create())=>(""!==e.userId&&t.uint32(10).string(e.userId),void 0!==e.wrapMode&&t.uint32(16).int32(e.wrapMode),void 0!==e.filterMode&&t.uint32(24).int32(e.filterMode),t),decode(e,t){const r=e instanceof minimalExports.Reader?e:new minimalExports.Reader(e);let n=void 0===t?r.len:r.pos+t;const i=createBaseAvatarTexture();for(;r.pos<n;){const e=r.uint32();switch(e>>>3){case 1:i.userId=r.string();break;case 2:i.wrapMode=r.int32();break;case 3:i.filterMode=r.int32();break;default:r.skipType(7&e)}}return i}};function createBaseTextureUnion(){return{tex:void 0}}const TextureUnion={encode:(e,t=minimalExports.Writer.create())=>("texture"===e.tex?.$case&&Texture.encode(e.tex.texture,t.uint32(10).fork()).ldelim(),"avatarTexture"===e.tex?.$case&&AvatarTexture.encode(e.tex.avatarTexture,t.uint32(18).fork()).ldelim(),t),decode(e,t){const r=e instanceof minimalExports.Reader?e:new minimalExports.Reader(e);let n=void 0===t?r.len:r.pos+t;const i=createBaseTextureUnion();for(;r.pos<n;){const e=r.uint32();switch(e>>>3){case 1:i.tex={$case:"texture",texture:Texture.decode(r,r.uint32())};break;case 2:i.tex={$case:"avatarTexture",avatarTexture:AvatarTexture.decode(r,r.uint32())};break;default:r.skipType(7&e)}}return i}};var MaterialTransparencyMode;function createBasePBMaterial(){return{material:void 0}}!function(e){e[e.MTM_OPAQUE=0]="MTM_OPAQUE",e[e.MTM_ALPHA_TEST=1]="MTM_ALPHA_TEST",e[e.MTM_ALPHA_BLEND=2]="MTM_ALPHA_BLEND",e[e.MTM_ALPHA_TEST_AND_ALPHA_BLEND=3]="MTM_ALPHA_TEST_AND_ALPHA_BLEND",e[e.MTM_AUTO=4]="MTM_AUTO"}(MaterialTransparencyMode||(MaterialTransparencyMode={}));const PBMaterial={encode:(e,t=minimalExports.Writer.create())=>("unlit"===e.material?.$case&&PBMaterial_UnlitMaterial.encode(e.material.unlit,t.uint32(10).fork()).ldelim(),"pbr"===e.material?.$case&&PBMaterial_PbrMaterial.encode(e.material.pbr,t.uint32(18).fork()).ldelim(),t),decode(e,t){const r=e instanceof minimalExports.Reader?e:new minimalExports.Reader(e);let n=void 0===t?r.len:r.pos+t;const i=createBasePBMaterial();for(;r.pos<n;){const e=r.uint32();switch(e>>>3){case 1:i.material={$case:"unlit",unlit:PBMaterial_UnlitMaterial.decode(r,r.uint32())};break;case 2:i.material={$case:"pbr",pbr:PBMaterial_PbrMaterial.decode(r,r.uint32())};break;default:r.skipType(7&e)}}return i}};function createBasePBMaterial_UnlitMaterial(){return{texture:void 0,alphaTest:void 0,castShadows:void 0}}const PBMaterial_UnlitMaterial={encode:(e,t=minimalExports.Writer.create())=>(void 0!==e.texture&&TextureUnion.encode(e.texture,t.uint32(10).fork()).ldelim(),void 0!==e.alphaTest&&t.uint32(21).float(e.alphaTest),void 0!==e.castShadows&&t.uint32(24).bool(e.castShadows),t),decode(e,t){const r=e instanceof minimalExports.Reader?e:new minimalExports.Reader(e);let n=void 0===t?r.len:r.pos+t;const i=createBasePBMaterial_UnlitMaterial();for(;r.pos<n;){const e=r.uint32();switch(e>>>3){case 1:i.texture=TextureUnion.decode(r,r.uint32());break;case 2:i.alphaTest=r.float();break;case 3:i.castShadows=r.bool();break;default:r.skipType(7&e)}}return i}};function createBasePBMaterial_PbrMaterial(){return{texture:void 0,alphaTest:void 0,castShadows:void 0,alphaTexture:void 0,emissiveTexture:void 0,bumpTexture:void 0,albedoColor:void 0,emissiveColor:void 0,reflectivityColor:void 0,transparencyMode:void 0,metallic:void 0,roughness:void 0,glossiness:void 0,specularIntensity:void 0,emissiveIntensity:void 0,directIntensity:void 0}}const PBMaterial_PbrMaterial={encode:(e,t=minimalExports.Writer.create())=>(void 0!==e.texture&&TextureUnion.encode(e.texture,t.uint32(10).fork()).ldelim(),void 0!==e.alphaTest&&t.uint32(21).float(e.alphaTest),void 0!==e.castShadows&&t.uint32(24).bool(e.castShadows),void 0!==e.alphaTexture&&TextureUnion.encode(e.alphaTexture,t.uint32(34).fork()).ldelim(),void 0!==e.emissiveTexture&&TextureUnion.encode(e.emissiveTexture,t.uint32(42).fork()).ldelim(),void 0!==e.bumpTexture&&TextureUnion.encode(e.bumpTexture,t.uint32(50).fork()).ldelim(),void 0!==e.albedoColor&&Color3.encode(e.albedoColor,t.uint32(58).fork()).ldelim(),void 0!==e.emissiveColor&&Color3.encode(e.emissiveColor,t.uint32(66).fork()).ldelim(),void 0!==e.reflectivityColor&&Color3.encode(e.reflectivityColor,t.uint32(74).fork()).ldelim(),void 0!==e.transparencyMode&&t.uint32(80).int32(e.transparencyMode),void 0!==e.metallic&&t.uint32(93).float(e.metallic),void 0!==e.roughness&&t.uint32(101).float(e.roughness),void 0!==e.glossiness&&t.uint32(109).float(e.glossiness),void 0!==e.specularIntensity&&t.uint32(117).float(e.specularIntensity),void 0!==e.emissiveIntensity&&t.uint32(125).float(e.emissiveIntensity),void 0!==e.directIntensity&&t.uint32(133).float(e.directIntensity),t),decode(e,t){const r=e instanceof minimalExports.Reader?e:new minimalExports.Reader(e);let n=void 0===t?r.len:r.pos+t;const i=createBasePBMaterial_PbrMaterial();for(;r.pos<n;){const e=r.uint32();switch(e>>>3){case 1:i.texture=TextureUnion.decode(r,r.uint32());break;case 2:i.alphaTest=r.float();break;case 3:i.castShadows=r.bool();break;case 4:i.alphaTexture=TextureUnion.decode(r,r.uint32());break;case 5:i.emissiveTexture=TextureUnion.decode(r,r.uint32());break;case 6:i.bumpTexture=TextureUnion.decode(r,r.uint32());break;case 7:i.albedoColor=Color3.decode(r,r.uint32());break;case 8:i.emissiveColor=Color3.decode(r,r.uint32());break;case 9:i.reflectivityColor=Color3.decode(r,r.uint32());break;case 10:i.transparencyMode=r.int32();break;case 11:i.metallic=r.float();break;case 12:i.roughness=r.float();break;case 13:i.glossiness=r.float();break;case 14:i.specularIntensity=r.float();break;case 15:i.emissiveIntensity=r.float();break;case 16:i.directIntensity=r.float();break;default:r.skipType(7&e)}}return i}},MaterialSchema={COMPONENT_ID:1017,serialize(e,t){const r=PBMaterial.encode(e),n=new Uint8Array(r.finish(),0,r.len);t.writeBuffer(n,!1)},deserialize:e=>PBMaterial.decode(e.buffer(),e.remainingBytes()),create:()=>PBMaterial.decode(new Uint8Array)};var ColliderLayer;function createBasePBMeshCollider(){return{collisionMask:void 0,mesh:void 0}}!function(e){e[e.CL_NONE=0]="CL_NONE",e[e.CL_POINTER=1]="CL_POINTER",e[e.CL_PHYSICS=2]="CL_PHYSICS"}(ColliderLayer||(ColliderLayer={}));const PBMeshCollider={encode:(e,t=minimalExports.Writer.create())=>(void 0!==e.collisionMask&&t.uint32(8).int32(e.collisionMask),"box"===e.mesh?.$case&&PBMeshCollider_BoxMesh.encode(e.mesh.box,t.uint32(18).fork()).ldelim(),"sphere"===e.mesh?.$case&&PBMeshCollider_SphereMesh.encode(e.mesh.sphere,t.uint32(26).fork()).ldelim(),"cylinder"===e.mesh?.$case&&PBMeshCollider_CylinderMesh.encode(e.mesh.cylinder,t.uint32(34).fork()).ldelim(),"plane"===e.mesh?.$case&&PBMeshCollider_PlaneMesh.encode(e.mesh.plane,t.uint32(42).fork()).ldelim(),t),decode(e,t){const r=e instanceof minimalExports.Reader?e:new minimalExports.Reader(e);let n=void 0===t?r.len:r.pos+t;const i=createBasePBMeshCollider();for(;r.pos<n;){const e=r.uint32();switch(e>>>3){case 1:i.collisionMask=r.int32();break;case 2:i.mesh={$case:"box",box:PBMeshCollider_BoxMesh.decode(r,r.uint32())};break;case 3:i.mesh={$case:"sphere",sphere:PBMeshCollider_SphereMesh.decode(r,r.uint32())};break;case 4:i.mesh={$case:"cylinder",cylinder:PBMeshCollider_CylinderMesh.decode(r,r.uint32())};break;case 5:i.mesh={$case:"plane",plane:PBMeshCollider_PlaneMesh.decode(r,r.uint32())};break;default:r.skipType(7&e)}}return i}};function createBasePBMeshCollider_BoxMesh(){return{}}const PBMeshCollider_BoxMesh={encode:(e,t=minimalExports.Writer.create())=>t,decode(e,t){const r=e instanceof minimalExports.Reader?e:new minimalExports.Reader(e);let n=void 0===t?r.len:r.pos+t;const i=createBasePBMeshCollider_BoxMesh();for(;r.pos<n;){const e=r.uint32();r.skipType(7&e)}return i}};function createBasePBMeshCollider_CylinderMesh(){return{radiusTop:void 0,radiusBottom:void 0}}const PBMeshCollider_CylinderMesh={encode:(e,t=minimalExports.Writer.create())=>(void 0!==e.radiusTop&&t.uint32(13).float(e.radiusTop),void 0!==e.radiusBottom&&t.uint32(21).float(e.radiusBottom),t),decode(e,t){const r=e instanceof minimalExports.Reader?e:new minimalExports.Reader(e);let n=void 0===t?r.len:r.pos+t;const i=createBasePBMeshCollider_CylinderMesh();for(;r.pos<n;){const e=r.uint32();switch(e>>>3){case 1:i.radiusTop=r.float();break;case 2:i.radiusBottom=r.float();break;default:r.skipType(7&e)}}return i}};function createBasePBMeshCollider_PlaneMesh(){return{}}const PBMeshCollider_PlaneMesh={encode:(e,t=minimalExports.Writer.create())=>t,decode(e,t){const r=e instanceof minimalExports.Reader?e:new minimalExports.Reader(e);let n=void 0===t?r.len:r.pos+t;const i=createBasePBMeshCollider_PlaneMesh();for(;r.pos<n;){const e=r.uint32();r.skipType(7&e)}return i}};function createBasePBMeshCollider_SphereMesh(){return{}}const PBMeshCollider_SphereMesh={encode:(e,t=minimalExports.Writer.create())=>t,decode(e,t){const r=e instanceof minimalExports.Reader?e:new minimalExports.Reader(e);let n=void 0===t?r.len:r.pos+t;const i=createBasePBMeshCollider_SphereMesh();for(;r.pos<n;){const e=r.uint32();r.skipType(7&e)}return i}},MeshColliderSchema={COMPONENT_ID:1019,serialize(e,t){const r=PBMeshCollider.encode(e),n=new Uint8Array(r.finish(),0,r.len);t.writeBuffer(n,!1)},deserialize:e=>PBMeshCollider.decode(e.buffer(),e.remainingBytes()),create:()=>PBMeshCollider.decode(new Uint8Array)};function createBasePBMeshRenderer(){return{mesh:void 0}}const PBMeshRenderer={encode:(e,t=minimalExports.Writer.create())=>("box"===e.mesh?.$case&&PBMeshRenderer_BoxMesh.encode(e.mesh.box,t.uint32(10).fork()).ldelim(),"sphere"===e.mesh?.$case&&PBMeshRenderer_SphereMesh.encode(e.mesh.sphere,t.uint32(18).fork()).ldelim(),"cylinder"===e.mesh?.$case&&PBMeshRenderer_CylinderMesh.encode(e.mesh.cylinder,t.uint32(26).fork()).ldelim(),"plane"===e.mesh?.$case&&PBMeshRenderer_PlaneMesh.encode(e.mesh.plane,t.uint32(34).fork()).ldelim(),t),decode(e,t){const r=e instanceof minimalExports.Reader?e:new minimalExports.Reader(e);let n=void 0===t?r.len:r.pos+t;const i=createBasePBMeshRenderer();for(;r.pos<n;){const e=r.uint32();switch(e>>>3){case 1:i.mesh={$case:"box",box:PBMeshRenderer_BoxMesh.decode(r,r.uint32())};break;case 2:i.mesh={$case:"sphere",sphere:PBMeshRenderer_SphereMesh.decode(r,r.uint32())};break;case 3:i.mesh={$case:"cylinder",cylinder:PBMeshRenderer_CylinderMesh.decode(r,r.uint32())};break;case 4:i.mesh={$case:"plane",plane:PBMeshRenderer_PlaneMesh.decode(r,r.uint32())};break;default:r.skipType(7&e)}}return i}};function createBasePBMeshRenderer_BoxMesh(){return{uvs:[]}}const PBMeshRenderer_BoxMesh={encode(e,t=minimalExports.Writer.create()){t.uint32(10).fork();for(const r of e.uvs)t.float(r);return t.ldelim(),t},decode(e,t){const r=e instanceof minimalExports.Reader?e:new minimalExports.Reader(e);let n=void 0===t?r.len:r.pos+t;const i=createBasePBMeshRenderer_BoxMesh();for(;r.pos<n;){const e=r.uint32();if(e>>>3==1)if(2==(7&e)){const e=r.uint32()+r.pos;for(;r.pos<e;)i.uvs.push(r.float())}else i.uvs.push(r.float());else r.skipType(7&e)}return i}};function createBasePBMeshRenderer_CylinderMesh(){return{radiusTop:void 0,radiusBottom:void 0}}const PBMeshRenderer_CylinderMesh={encode:(e,t=minimalExports.Writer.create())=>(void 0!==e.radiusTop&&t.uint32(13).float(e.radiusTop),void 0!==e.radiusBottom&&t.uint32(21).float(e.radiusBottom),t),decode(e,t){const r=e instanceof minimalExports.Reader?e:new minimalExports.Reader(e);let n=void 0===t?r.len:r.pos+t;const i=createBasePBMeshRenderer_CylinderMesh();for(;r.pos<n;){const e=r.uint32();switch(e>>>3){case 1:i.radiusTop=r.float();break;case 2:i.radiusBottom=r.float();break;default:r.skipType(7&e)}}return i}};function createBasePBMeshRenderer_PlaneMesh(){return{uvs:[]}}const PBMeshRenderer_PlaneMesh={encode(e,t=minimalExports.Writer.create()){t.uint32(10).fork();for(const r of e.uvs)t.float(r);return t.ldelim(),t},decode(e,t){const r=e instanceof minimalExports.Reader?e:new minimalExports.Reader(e);let n=void 0===t?r.len:r.pos+t;const i=createBasePBMeshRenderer_PlaneMesh();for(;r.pos<n;){const e=r.uint32();if(e>>>3==1)if(2==(7&e)){const e=r.uint32()+r.pos;for(;r.pos<e;)i.uvs.push(r.float())}else i.uvs.push(r.float());else r.skipType(7&e)}return i}};function createBasePBMeshRenderer_SphereMesh(){return{}}const PBMeshRenderer_SphereMesh={encode:(e,t=minimalExports.Writer.create())=>t,decode(e,t){const r=e instanceof minimalExports.Reader?e:new minimalExports.Reader(e);let n=void 0===t?r.len:r.pos+t;const i=createBasePBMeshRenderer_SphereMesh();for(;r.pos<n;){const e=r.uint32();r.skipType(7&e)}return i}},MeshRendererSchema={COMPONENT_ID:1018,serialize(e,t){const r=PBMeshRenderer.encode(e),n=new Uint8Array(r.finish(),0,r.len);t.writeBuffer(n,!1)},deserialize:e=>PBMeshRenderer.decode(e.buffer(),e.remainingBytes()),create:()=>PBMeshRenderer.decode(new Uint8Array)};function createBaseRaycastHit(){return{position:void 0,origin:void 0,direction:void 0,normalHit:void 0,length:0,meshName:void 0,entityId:void 0}}const RaycastHit={encode:(e,t=minimalExports.Writer.create())=>(void 0!==e.position&&Vector3.encode(e.position,t.uint32(10).fork()).ldelim(),void 0!==e.origin&&Vector3.encode(e.origin,t.uint32(18).fork()).ldelim(),void 0!==e.direction&&Vector3.encode(e.direction,t.uint32(26).fork()).ldelim(),void 0!==e.normalHit&&Vector3.encode(e.normalHit,t.uint32(34).fork()).ldelim(),0!==e.length&&t.uint32(45).float(e.length),void 0!==e.meshName&&t.uint32(50).string(e.meshName),void 0!==e.entityId&&t.uint32(56).int64(e.entityId),t),decode(e,t){const r=e instanceof minimalExports.Reader?e:new minimalExports.Reader(e);let n=void 0===t?r.len:r.pos+t;const i=createBaseRaycastHit();for(;r.pos<n;){const e=r.uint32();switch(e>>>3){case 1:i.position=Vector3.decode(r,r.uint32());break;case 2:i.origin=Vector3.decode(r,r.uint32());break;case 3:i.direction=Vector3.decode(r,r.uint32());break;case 4:i.normalHit=Vector3.decode(r,r.uint32());break;case 5:i.length=r.float();break;case 6:i.meshName=r.string();break;case 7:i.entityId=longToNumber(r.int64());break;default:r.skipType(7&e)}}return i}};var globalThis$1=(()=>{if(void 0!==globalThis$1)return globalThis$1;if("undefined"!=typeof self)return self;if("undefined"!=typeof global)return global;throw"Unable to locate global object"})();function longToNumber(e){if(e.gt(Number.MAX_SAFE_INTEGER))throw new globalThis$1.Error("Value is larger than Number.MAX_SAFE_INTEGER");return e.toNumber()}function createBasePBPointerEventsResult(){return{commands:[]}}minimalExports.util.Long!==longExports&&(minimalExports.util.Long=longExports,minimalExports.configure());const PBPointerEventsResult={encode(e,t=minimalExports.Writer.create()){for(const r of e.commands)PBPointerEventsResult_PointerCommand.encode(r,t.uint32(10).fork()).ldelim();return t},decode(e,t){const r=e instanceof minimalExports.Reader?e:new minimalExports.Reader(e);let n=void 0===t?r.len:r.pos+t;const i=createBasePBPointerEventsResult();for(;r.pos<n;){const e=r.uint32();if(e>>>3==1)i.commands.push(PBPointerEventsResult_PointerCommand.decode(r,r.uint32()));else r.skipType(7&e)}return i}};function createBasePBPointerEventsResult_PointerCommand(){return{button:0,hit:void 0,state:0,timestamp:0,analog:void 0}}const PBPointerEventsResult_PointerCommand={encode:(e,t=minimalExports.Writer.create())=>(0!==e.button&&t.uint32(8).int32(e.button),void 0!==e.hit&&RaycastHit.encode(e.hit,t.uint32(18).fork()).ldelim(),0!==e.state&&t.uint32(32).int32(e.state),0!==e.timestamp&&t.uint32(40).int32(e.timestamp),void 0!==e.analog&&t.uint32(53).float(e.analog),t),decode(e,t){const r=e instanceof minimalExports.Reader?e:new minimalExports.Reader(e);let n=void 0===t?r.len:r.pos+t;const i=createBasePBPointerEventsResult_PointerCommand();for(;r.pos<n;){const e=r.uint32();switch(e>>>3){case 1:i.button=r.int32();break;case 2:i.hit=RaycastHit.decode(r,r.uint32());break;case 4:i.state=r.int32();break;case 5:i.timestamp=r.int32();break;case 6:i.analog=r.float();break;default:r.skipType(7&e)}}return i}},PointerEventsResultSchema={COMPONENT_ID:1063,serialize(e,t){const r=PBPointerEventsResult.encode(e),n=new Uint8Array(r.finish(),0,r.len);t.writeBuffer(n,!1)},deserialize:e=>PBPointerEventsResult.decode(e.buffer(),e.remainingBytes()),create:()=>PBPointerEventsResult.decode(new Uint8Array)};var PointerEventType;function createBasePBPointerHoverFeedback(){return{pointerEvents:[]}}!function(e){e[e.PET_UP=0]="PET_UP",e[e.PET_DOWN=1]="PET_DOWN",e[e.PET_HOVER_ENTER=2]="PET_HOVER_ENTER",e[e.PET_HOVER_LEAVE=3]="PET_HOVER_LEAVE"}(PointerEventType||(PointerEventType={}));const PBPointerHoverFeedback={encode(e,t=minimalExports.Writer.create()){for(const r of e.pointerEvents)PBPointerHoverFeedback_Entry.encode(r,t.uint32(10).fork()).ldelim();return t},decode(e,t){const r=e instanceof minimalExports.Reader?e:new minimalExports.Reader(e);let n=void 0===t?r.len:r.pos+t;const i=createBasePBPointerHoverFeedback();for(;r.pos<n;){const e=r.uint32();if(e>>>3==1)i.pointerEvents.push(PBPointerHoverFeedback_Entry.decode(r,r.uint32()));else r.skipType(7&e)}return i}};function createBasePBPointerHoverFeedback_Info(){return{button:void 0,hoverText:void 0,maxDistance:void 0,showFeedback:void 0}}const PBPointerHoverFeedback_Info={encode:(e,t=minimalExports.Writer.create())=>(void 0!==e.button&&t.uint32(8).int32(e.button),void 0!==e.hoverText&&t.uint32(18).string(e.hoverText),void 0!==e.maxDistance&&t.uint32(29).float(e.maxDistance),void 0!==e.showFeedback&&t.uint32(32).bool(e.showFeedback),t),decode(e,t){const r=e instanceof minimalExports.Reader?e:new minimalExports.Reader(e);let n=void 0===t?r.len:r.pos+t;const i=createBasePBPointerHoverFeedback_Info();for(;r.pos<n;){const e=r.uint32();switch(e>>>3){case 1:i.button=r.int32();break;case 2:i.hoverText=r.string();break;case 3:i.maxDistance=r.float();break;case 4:i.showFeedback=r.bool();break;default:r.skipType(7&e)}}return i}};function createBasePBPointerHoverFeedback_Entry(){return{eventType:0,eventInfo:void 0}}const PBPointerHoverFeedback_Entry={encode:(e,t=minimalExports.Writer.create())=>(0!==e.eventType&&t.uint32(8).int32(e.eventType),void 0!==e.eventInfo&&PBPointerHoverFeedback_Info.encode(e.eventInfo,t.uint32(18).fork()).ldelim(),t),decode(e,t){const r=e instanceof minimalExports.Reader?e:new minimalExports.Reader(e);let n=void 0===t?r.len:r.pos+t;const i=createBasePBPointerHoverFeedback_Entry();for(;r.pos<n;){const e=r.uint32();switch(e>>>3){case 1:i.eventType=r.int32();break;case 2:i.eventInfo=PBPointerHoverFeedback_Info.decode(r,r.uint32());break;default:r.skipType(7&e)}}return i}},PointerHoverFeedbackSchema={COMPONENT_ID:1062,serialize(e,t){const r=PBPointerHoverFeedback.encode(e),n=new Uint8Array(r.finish(),0,r.len);t.writeBuffer(n,!1)},deserialize:e=>PBPointerHoverFeedback.decode(e.buffer(),e.remainingBytes()),create:()=>PBPointerHoverFeedback.decode(new Uint8Array)},Animator$1=e=>e.defineComponentFromSchema(AnimatorSchema,AnimatorSchema.COMPONENT_ID),Material$1=e=>e.defineComponentFromSchema(MaterialSchema,MaterialSchema.COMPONENT_ID),MeshCollider$1=e=>e.defineComponentFromSchema(MeshColliderSchema,MeshColliderSchema.COMPONENT_ID),MeshRenderer$1=e=>e.defineComponentFromSchema(MeshRendererSchema,MeshRendererSchema.COMPONENT_ID),PointerEventsResult=e=>e.defineComponentFromSchema(PointerEventsResultSchema,PointerEventsResultSchema.COMPONENT_ID),PointerHoverFeedback=e=>e.defineComponentFromSchema(PointerHoverFeedbackSchema,PointerHoverFeedbackSchema.COMPONENT_ID),COMPONENT_ID=1,TRANSFORM_LENGTH=44,TransformSchema={serialize(e,t){const r=t.incrementWriteOffset(TRANSFORM_LENGTH);t.setFloat32(r,e.position.x),t.setFloat32(r+4,e.position.y),t.setFloat32(r+8,e.position.z),t.setFloat32(r+12,e.rotation.x),t.setFloat32(r+16,e.rotation.y),t.setFloat32(r+20,e.rotation.z),t.setFloat32(r+24,e.rotation.w),t.setFloat32(r+28,e.scale.x),t.setFloat32(r+32,e.scale.y),t.setFloat32(r+36,e.scale.z),t.setUint32(r+40,e.parent||0)},deserialize(e){const t=e.incrementReadOffset(TRANSFORM_LENGTH);return{position:{x:e.getFloat32(t),y:e.getFloat32(t+4),z:e.getFloat32(t+8)},rotation:{x:e.getFloat32(t+12),y:e.getFloat32(t+16),z:e.getFloat32(t+20),w:e.getFloat32(t+24)},scale:{x:e.getFloat32(t+28),y:e.getFloat32(t+32),z:e.getFloat32(t+36)},parent:e.getUint32(t+40)}},create:()=>({position:{x:0,y:0,z:0},scale:{x:1,y:1,z:1},rotation:{x:0,y:0,z:0,w:1}})};function defineTransformComponent(e){return e.defineComponentFromSchema(TransformSchema,COMPONENT_ID)}function defineAnimatorComponent(e){const t=Animator$1(e);function r(e,r){const n=t.getMutableOrNull(e);if(!n)return[null,null];const i=n.states.find((e=>e.name===r||e.clip===r));return i?[n,i]:[n,null]}return{...t,getClipOrNull(e,t){const[n,i]=r(e,t);return i},getClip(e,t){const[n,i]=r(e,t);if(!n)throw new Error(`There is no Animator found in the entity ${e}`);if(!i)throw new Error(`The Animator component of ${e} has no the state ${t}`);return i},playSingleAnimation(e,t,n=!0){const[i,o]=r(e,t);if(!i||!o)return!1;for(const e of i.states)e.playing=!1,e.shouldReset=!0;return o.playing=!0,o.shouldReset=n,!0},stopAllAnimations(e,r=!0){const n=t.getMutableOrNull(e);if(!n)return!1;for(const e of n.states)e.playing=!1,e.shouldReset=r;return!0}}}function defineMeshColliderComponent(e){const t=MeshCollider$1(e);function r(e){return Array.isArray(e)?e.map((e=>e)).reduce(((e,t)=>e|t),0):e||void 0}return{...t,setBox(e,n){t.createOrReplace(e,{mesh:{$case:"box",box:{}},collisionMask:r(n)})},setPlane(e,n){t.createOrReplace(e,{mesh:{$case:"plane",plane:{}},collisionMask:r(n)})},setCylinder(e,n,i,o){t.createOrReplace(e,{mesh:{$case:"cylinder",cylinder:{radiusBottom:n,radiusTop:i}},collisionMask:r(o)})},setSphere(e,n){t.createOrReplace(e,{mesh:{$case:"sphere",sphere:{}},collisionMask:r(n)})}}}function defineMeshRendererComponent(e){const t=MeshRenderer$1(e);return{...t,setBox(e,r){t.createOrReplace(e,{mesh:{$case:"box",box:{uvs:r||[]}}})},setPlane(e,r){t.createOrReplace(e,{mesh:{$case:"plane",plane:{uvs:r||[]}}})},setCylinder(e,r,n){t.createOrReplace(e,{mesh:{$case:"cylinder",cylinder:{radiusBottom:r,radiusTop:n}}})},setSphere(e){t.createOrReplace(e,{mesh:{$case:"sphere",sphere:{}}})}}}const TextureHelper={Common:e=>({tex:{$case:"texture",texture:e}}),Avatar:e=>({tex:{$case:"avatarTexture",avatarTexture:e}})};function defineMaterialComponent(e){const t=Material$1(e);return{...t,Texture:TextureHelper,setBasicMaterial(e,r){t.createOrReplace(e,{material:{$case:"unlit",unlit:r}})},setPbrMaterial(e,r){t.createOrReplace(e,{material:{$case:"pbr",pbr:r}})}}}const Transform$1=e=>defineTransformComponent(e),Material=e=>defineMaterialComponent(e),Animator=e=>defineAnimatorComponent(e),MeshRenderer=e=>defineMeshRendererComponent(e),MeshCollider=e=>defineMeshColliderComponent(e);function IArray(e){return{serialize(t,r){r.writeUint32(t.length);for(const n of t)e.serialize(n,r)},deserialize(t){const r=[],n=t.readUint32();for(let i=0;i<n;i++)r.push(e.deserialize(t));return r},create:()=>[]}}const Bool={serialize(e,t){t.writeInt8(e?1:0)},deserialize:e=>1===e.readInt8(),create:()=>!1};function IEnum(e){return{serialize(t,r){e.serialize(t,r)},deserialize:t=>e.deserialize(t),create:()=>e.create()}}const Float32={serialize(e,t){t.writeFloat32(e)},deserialize:e=>e.readFloat32(),create:()=>0},Float64={serialize(e,t){t.writeFloat64(e)},deserialize:e=>e.readFloat64(),create:()=>0},Int64={serialize(e,t){t.writeInt64(BigInt(e))},deserialize:e=>Number(e.readInt64()),create:()=>0},Int32={serialize(e,t){t.writeInt32(e)},deserialize:e=>e.readInt32(),create:()=>0},Int16={serialize(e,t){t.writeInt16(e)},deserialize:e=>e.readInt16(),create:()=>0},Int8={serialize(e,t){t.writeInt8(e)},deserialize:e=>e.readInt8(),create:()=>0},FlatString={serialize(e,t){t.writeBuffer((new TextEncoder).encode(e))},deserialize:e=>(new TextDecoder).decode(e.readBuffer()),create:()=>""},EcsString=FlatString,Color3Schema={serialize(e,t){t.writeFloat32(e.r),t.writeFloat32(e.g),t.writeFloat32(e.b)},deserialize:e=>({r:e.readFloat32(),g:e.readFloat32(),b:e.readFloat32()}),create:()=>({r:0,g:0,b:0})},Color4Schema={serialize(e,t){t.writeFloat32(e.r),t.writeFloat32(e.g),t.writeFloat32(e.b),t.writeFloat32(e.a)},deserialize:e=>({r:e.readFloat32(),g:e.readFloat32(),b:e.readFloat32(),a:e.readFloat32()}),create:()=>({r:0,g:0,b:0,a:0})},EntitySchema={serialize(e,t){t.writeInt32(e)},deserialize:e=>e.readInt32(),create:()=>0},QuaternionSchema={serialize(e,t){t.writeFloat32(e.x),t.writeFloat32(e.y),t.writeFloat32(e.z),t.writeFloat32(e.w)},deserialize:e=>({x:e.readFloat32(),y:e.readFloat32(),z:e.readFloat32(),w:e.readFloat32()}),create:()=>({x:0,y:0,z:0,w:0})},Vector3Schema={serialize(e,t){t.writeFloat32(e.x),t.writeFloat32(e.y),t.writeFloat32(e.z)},deserialize:e=>({x:e.readFloat32(),y:e.readFloat32(),z:e.readFloat32()}),create:()=>({x:0,y:0,z:0})};function IMap(e){return{serialize(t,r){for(const n in e)e[n].serialize(t[n],r)},deserialize(t){const r={};for(const n in e)r[n]=e[n].deserialize(t);return r},create(){const t={};for(const r in e)t[r]=e[r].create();return t}}}function IOptional(e){return{serialize(t,r){t?(r.writeInt8(1),e.serialize(t,r)):r.writeInt8(0)},deserialize(t){if(t.readInt8())return e.deserialize(t)},create(){}}}var Schemas;!function(e){e.Boolean=Bool,e.String=EcsString,e.Float=Float32,e.Double=Float64,e.Byte=Int8,e.Short=Int16,e.Int=Int32,e.Int64=Int64,e.Number=Float32,e.Vector3=Vector3Schema,e.Quaternion=QuaternionSchema,e.Color3=Color3Schema,e.Color4=Color4Schema,e.Entity=EntitySchema,e.Enum=IEnum,e.Array=IArray,e.Map=IMap,e.Optional=IOptional}(Schemas||(Schemas={}));var dist={},types={},hasRequiredTypes,hasRequiredDist;function requireTypes(){return hasRequiredTypes||(hasRequiredTypes=1,Object.defineProperty(types,"__esModule",{value:!0})),types}function requireDist(){return hasRequiredDist||(hasRequiredDist=1,function(e){var t=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),r=commonjsGlobal&&commonjsGlobal.__exportStar||function(e,r){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(r,n)||t(r,e,n)};Object.defineProperty(e,"__esModule",{value:!0}),e.crdtProtocol=e.stateIterator=e.sameData=void 0,r(requireTypes(),e);const n=globalThis.Buffer;function i(e,t){if(e===t)return!0;if(e instanceof Uint8Array&&t instanceof Uint8Array){if(e.byteLength!==t.byteLength)return!1;for(let r=0;r<e.byteLength;r++)if(e[r]!==t[r])return!1;return!0}return!!(n&&e instanceof n&&t instanceof n)&&e.equals(t)}e.sameData=i,e.stateIterator=function*(e){for(const[t,r]of e.entries())for(const[e,n]of r.entries())yield[t,e,n]},e.crdtProtocol=function(){const e=new Map;function t(t,r,n,i){const o=e.get(t),s=Math.max(i,o?.get(r)?.timestamp||0);if(o)o.set(r,{timestamp:s,data:n});else{const i=new Map;i.set(r,{timestamp:s,data:n}),e.set(t,i)}return{timestamp:s,data:n}}return{createEvent:function(r,n,i){const o=(e.get(r)?.get(n)?.timestamp||0)+1;return t(r,n,i,o),{key1:r,key2:n,data:i,timestamp:o}},processMessage:function(r){const{key1:n,key2:o,data:s,timestamp:a}=r,u=e.get(n)?.get(o);return!u||u.timestamp<a?(t(n,o,s,a),r):u.timestamp>a?{key1:n,key2:o,data:u.data,timestamp:u.timestamp}:i(u.data,s)?r:function(e,t){return e>t}(u.data,s)?{key1:n,key2:o,data:u.data,timestamp:u.timestamp}:(t(n,o,s,a).data,r)},getState:function(){return e}}}}(dist)),dist}var distExports=requireDist();function getNextSize(e,t){const r=Math.max(e,t)+1024;return 1024*Math.ceil(r/1024)}const defaultInitialCapacity=10240;function createByteBuffer(e={}){const t=e.reading?.currentOffset||0;let r=null,n=0;e.writing?(r=e.writing.buffer,e.writing.currentOffset&&(n=e.writing.currentOffset)):e.reading?(r=e.reading.buffer,n=e.reading.length||e.reading.buffer.length):r=new Uint8Array(e.initialCapacity||defaultInitialCapacity);let i=r,o=new DataView(i.buffer,i.byteOffset),s=n,a=t;const u=e=>{if(s+e>i.byteLength){const t=getNextSize(i.byteLength,s+e),r=new Uint8Array(t);r.set(i),i=r,o=new DataView(i.buffer)}return s+=e,s-e},c=e=>{if(a+e>s)throw new Error("Outside of the bounds of writen data.");return a+=e,a-e};return{buffer:()=>i,bufferLength:()=>i.length,resetBuffer(){a=0,s=0},currentReadOffset:()=>a,currentWriteOffset:()=>s,incrementReadOffset:e=>c(e),remainingBytes:()=>s-a,readFloat32:()=>o.getFloat32(c(4)),readFloat64:()=>o.getFloat64(c(8)),readInt8:()=>o.getInt8(c(1)),readInt16:()=>o.getInt16(c(2)),readInt32:()=>o.getInt32(c(4)),readInt64:()=>o.getBigInt64(c(8)),readUint8:()=>o.getUint8(c(1)),readUint16:()=>o.getUint16(c(2)),readUint32:()=>o.getUint32(c(4)),readUint64:()=>o.getBigUint64(c(8)),readBuffer(){const e=o.getUint32(c(4));return i.subarray(c(e),c(0))},incrementWriteOffset:e=>u(e),size:()=>s,toBinary:()=>i.subarray(0,s),toCopiedBinary(){return new Uint8Array(this.toBinary())},writeBuffer(e,t=!0){t&&this.writeUint32(e.byteLength);const r=u(e.byteLength);i.set(e,r)},writeFloat32(e){const t=u(4);o.setFloat32(t,e)},writeFloat64(e){const t=u(8);o.setFloat64(t,e)},writeInt8(e){const t=u(1);o.setInt8(t,e)},writeInt16(e){const t=u(2);o.setInt16(t,e)},writeInt32(e){const t=u(4);o.setInt32(t,e)},writeInt64(e){const t=u(8);o.setBigInt64(t,e)},writeUint8(e){const t=u(1);o.setUint8(t,e)},writeUint16(e){const t=u(2);o.setUint16(t,e)},writeUint32(e){const t=u(4);o.setUint32(t,e)},writeUint64(e){const t=u(8);o.setBigUint64(t,e)},getFloat32:e=>o.getFloat32(e),getFloat64:e=>o.getFloat64(e),getInt8:e=>o.getInt8(e),getInt16:e=>o.getInt16(e),getInt32:e=>o.getInt32(e),getInt64:e=>o.getBigInt64(e),getUint8:e=>o.getUint8(e),getUint16:e=>o.getUint16(e),getUint32:e=>o.getUint32(e),getUint64:e=>o.getBigUint64(e),setFloat32(e,t){o.setFloat32(e,t)},setFloat64(e,t){o.setFloat64(e,t)},setInt8(e,t){o.setInt8(e,t)},setInt16(e,t){o.setInt16(e,t)},setInt32(e,t){o.setInt32(e,t)},setInt64(e,t){o.setBigInt64(e,t)},setUint8(e,t){o.setUint8(e,t)},setUint16(e,t){o.setUint16(e,t)},setUint32(e,t){o.setUint32(e,t)},setUint64(e,t){o.setBigUint64(e,t)}}}var WireMessage;!function(e){let t;function r(t){const r=t.remainingBytes();if(r<e.HEADER_LENGTH)return!1;return!(r<t.getUint32(t.currentReadOffset()))}!function(e){e[e.RESERVED=0]="RESERVED",e[e.PUT_COMPONENT=1]="PUT_COMPONENT",e[e.DELETE_COMPONENT=2]="DELETE_COMPONENT",e[e.MAX_MESSAGE_TYPE=3]="MAX_MESSAGE_TYPE"}(t=e.Enum||(e.Enum={})),e.HEADER_LENGTH=8,e.validate=r,e.readHeader=function(e){return r(e)?{length:e.readUint32(),type:e.readUint32()}:null},e.getType=function(e,r){return e.has(r)?t.PUT_COMPONENT:t.DELETE_COMPONENT}}(WireMessage||(WireMessage={}));var WireMessage$1=WireMessage,ComponentOperation,EntityUtils;function crdtSceneSystem(e){const t=[],r=distExports.crdtProtocol(),n=[],i=[],o=[];function s(e){return e.splice(0,e.length)}return{getCrdt:function(){return r.getState()},createAndSendMessages:async function(n){const a=s(i),u=createByteBuffer();for(const[i,o]of n)for(const n of o){const o=e.getComponent(n),s=o.has(i)?o.toBinary(i).toBinary():null,c=r.createEvent(i,n,s),l=u.currentWriteOffset(),f=WireMessage$1.getType(o,i),d={type:f,componentId:n,entity:i,timestamp:c.timestamp};t.some((e=>e.filter(d)))&&(ComponentOperation.write(f,i,c.timestamp,o,u),a.push({...d,messageBuffer:u.buffer().subarray(l,u.currentWriteOffset())}))}const c=createByteBuffer();for(const e of t){c.resetBuffer();for(const t of o)t.transportType===e.type&&c.writeBuffer(t.messageBuffer,!1);for(const t of a)e.filter(t)&&c.writeBuffer(t.messageBuffer,!1);const t=c.size()?c.toBinary():new Uint8Array([]);await e.send(t)}},receiveMessages:async function(){const t=s(n),a=createByteBuffer();for(const n of t){const{data:t,timestamp:s,componentId:u,entity:c,type:l}=n,f={key1:c,key2:u,data:t||null,timestamp:s},d=e.getComponentOrNull(u),h=r.processMessage(f);if(d)if(f!==h){const e=a.currentWriteOffset(),t=WireMessage$1.getType(d,c),r=h.timestamp;ComponentOperation.write(t,c,r,d,a),o.push({...n,timestamp:h.timestamp,messageBuffer:a.buffer().subarray(e,a.currentWriteOffset())})}else{if(i.push(n),l===WireMessage$1.Enum.DELETE_COMPONENT)d.deleteFrom(c);else{const e=createByteBuffer({reading:{buffer:n.data,currentOffset:0}});d.upsertFromBinary(n.entity,e)}d.clearDirty()}}},addTransport:function(e){if(t.find((t=>e.type===t.type)))throw new Error("Transport already added");var r;t.push(e),e.onmessage=(r=e.type,function(e){const t=createByteBuffer({reading:{buffer:e,currentOffset:0}});for(;WireMessage$1.validate(t);){const e=t.currentReadOffset(),i=ComponentOperation.read(t),{type:o,entity:s,componentId:a,data:u,timestamp:c}=i;n.push({type:o,entity:s,componentId:a,data:u,timestamp:c,transportType:r,messageBuffer:t.buffer().subarray(e,t.currentReadOffset())})}})}}}function deepReadonly(e){return Object.freeze({...e})}function defineComponent(e,t,r){const n=new Map,i=new Set,o=createByteBuffer();function s(){return r?t.deserialize(createByteBuffer({writing:{buffer:o.buffer(),currentOffset:o.currentWriteOffset()}})):t.create()}function a(e){return{...s(),...e}}return r&&t.serialize(r,o),{_id:e,default:()=>s(),isDirty:e=>i.has(e),has:e=>n.has(e),deleteFrom(e){const t=n.get(e);return n.delete(e),i.add(e),t||null},getOrNull(e){const t=n.get(e);return t?deepReadonly(t):null},get(t){const r=n.get(t);if(!r)throw new Error(`[getFrom] Component ${e} for entity #${t} not found`);return deepReadonly(r)},create(t,r){if(n.get(t))throw new Error(`[create] Component ${e} for ${t} already exists`);const o=void 0===r?s():a(r);return n.set(t,o),i.add(t),o},createOrReplace(e,t){const r=void 0===t?s():a(t);return n.set(e,r),i.add(e),r},getMutableOrNull(e){const t=n.get(e);return t?(i.add(e),t):null},getMutable(t){const r=this.getMutableOrNull(t);if(null===r)throw new Error(`[mutable] Component ${e} for ${t} not found`);return r},*iterator(){for(const[e,t]of n)yield[e,t]},*dirtyIterator(){for(const e of i)yield e},toBinary(r){const i=n.get(r);if(!i)throw new Error(`[toBinary] Component ${e} for ${r} not found`);const o=createByteBuffer();return t.serialize(i,o),o},writeToByteBuffer(r,i){const o=n.get(r);if(!o)throw new Error(`[writeToByteBuffer] Component ${e} for entity #${r} not found`);t.serialize(o,i)},updateFromBinary(t,r){if(!n.get(t))throw new Error(`[updateFromBinary] Component ${e} for ${t} not found`);return this.upsertFromBinary(t,r)},upsertFromBinary(e,r){const o=t.deserialize(r);return n.set(e,o),i.add(e),o},clearDirty(){i.clear()}}}function EntityContainer(){const e=Entity(EntityUtils.STATIC_ENTITIES_RANGE),t=Entity(EntityUtils.DYNAMIC_ENTITIES_RANGE);return{generateEntity:(r=!1)=>r?t.generateEntity():e.generateEntity(),removeEntity:r=>e.removeEntity(r)||t.removeEntity(r),entityExists:r=>EntityUtils.isReservedEntity(r)||e.getExistingEntities().has(r)||t.getExistingEntities().has(r),getExistingEntities:()=>new Set([...e.getExistingEntities(),...t.getExistingEntities()])}}function Entity(e){let t=e[0];const r=new Set;return{getExistingEntities:()=>new Set(r),generateEntity:function(){if(t>=e[1])throw new Error(`It fails trying to generate an entity out of range [${e[0]}, ${e[1]}].`);const n=t;return t++,r.add(n),n},removeEntity:function(e){return r.delete(e)}}}!function(e){e.MESSAGE_HEADER_LENGTH=20,e.write=function(t,r,n,i,o){const s=o.incrementWriteOffset(WireMessage$1.HEADER_LENGTH+e.MESSAGE_HEADER_LENGTH);t===WireMessage$1.Enum.PUT_COMPONENT&&i.writeToByteBuffer(r,o);const a=o.size()-s;o.setUint32(s,a),o.setUint32(s+4,t),o.setUint32(s+8,r),o.setUint32(s+12,i._id),o.setUint64(s+16,BigInt(n)),o.setUint32(s+24,a-e.MESSAGE_HEADER_LENGTH-WireMessage$1.HEADER_LENGTH)},e.read=function(e){const t=WireMessage$1.readHeader(e);if(!t)return null;const r={...t,entity:e.readUint32(),componentId:e.readInt32(),timestamp:Number(e.readUint64())};return t.type===WireMessage$1.Enum.DELETE_COMPONENT?r:{...r,data:e.readBuffer()}}}(ComponentOperation||(ComponentOperation={})),function(e){function t(e,t){return e>=t[0]&&e<=t[1]}e.MAX_ENTITIES=4294967295,e.DYNAMIC_ENTITIES_START_AT=1e5,e.RESERVED_STATIC_ENTITIES=512,e.RESERVED_ENTITIES_RANGE=[0,e.RESERVED_STATIC_ENTITIES-1],e.STATIC_ENTITIES_RANGE=[e.RESERVED_STATIC_ENTITIES,e.MAX_ENTITIES],e.DYNAMIC_ENTITIES_RANGE=[e.DYNAMIC_ENTITIES_START_AT,e.MAX_ENTITIES],e.isDynamicEntity=function(r){return t(r,e.DYNAMIC_ENTITIES_RANGE)},e.isStaticEntity=function(r){return t(r,e.STATIC_ENTITIES_RANGE)},e.isReservedEntity=function(r){return t(r,e.RESERVED_ENTITIES_RANGE)}}(EntityUtils||(EntityUtils={}));const SYSTEMS_REGULAR_PRIORITY=1e5;function SystemContainer(){const e=[];function t(){e.sort(((e,t)=>t.priority-e.priority))}return{add:function(r,n,i){const o=i??r.name;if(e.find((e=>e.fn===r)))throw new Error(`System ${JSON.stringify(o)} already added to the engine`);e.push({fn:r,priority:n,name:o}),t()},remove:function(r){let n=-1;return n="string"==typeof r?e.findIndex((e=>e.name===r)):e.findIndex((e=>e.fn===r)),-1!==n&&(e.splice(n,1),t(),!0)},getSystems:()=>e}}const InputCommands=[0,1,2,4,5,6,7,8,9,10,11,12,13],InternalInputStateSchema={timestampLastUpdate:Schemas.Number,currentTimestamp:Schemas.Number,buttonState:Schemas.Array(Schemas.Map({value:Schemas.Boolean,ts:Schemas.Number}))},InternalInputStateComponentId=1500,TimestampUpdateSystemPriority=1<<20,ButtonStateUpdateSystemPriority=0;function createInputSystem(e){const t=PointerEventsResult(e),r=e.defineComponent(InternalInputStateSchema,InternalInputStateComponentId);function n(e,t){if(3!==e)return i(e,t);for(const e of InputCommands){const r=i(e,t);if(r)return r}return null}function i(n,i){const o=t.getOrNull(e.RootEntity);if(!o)return null;const s=o.commands,a=findLastAction(s,1,n,i);if(!a)return null;const u=findLastAction(s,0,n,i);if(!u)return null;const c=r.get(e.RootEntity);return a.timestamp<u.timestamp&&u.timestamp>c.timestampLastUpdate?(r.getMutable(e.RootEntity).currentTimestamp=Math.max(u.timestamp,c.currentTimestamp),{up:u,down:a}):null}function o(e,t,r){if(3!==e)return s(e,t,r);for(const e of InputCommands){const n=s(e,t,r);if(n)return n}return null}function s(n,i,o){const s=t.getOrNull(e.RootEntity);if(!s)return null;const a=findLastAction(s.commands,i,n,o);if(!a)return null;const u=r.get(e.RootEntity);return a.timestamp>u.timestampLastUpdate?(r.getMutable(e.RootEntity).currentTimestamp=Math.max(a.timestamp,u.currentTimestamp),a):null}return r.create(e.RootEntity,{buttonState:Array.from({length:InputCommands.length},(()=>({ts:0,value:!1})))}),e.addSystem((function(){const n=t.getOrNull(e.RootEntity);if(!n)return;const i=r.getMutable(e.RootEntity);for(const e of n.commands)e.timestamp>i.buttonState[e.button].ts&&(1===e.state?i.buttonState[e.button].value=!0:0===e.state&&(i.buttonState[e.button].value=!1))}),ButtonStateUpdateSystemPriority,"@dcl/ecs#buttonStateUpdateSystem"),e.addSystem((function(){const t=r.get(e.RootEntity);t.currentTimestamp>t.timestampLastUpdate&&(r.getMutable(e.RootEntity).timestampLastUpdate=t.currentTimestamp)}),TimestampUpdateSystemPriority,"@dcl/ecs#timestampUpdateSystem"),{isPressed:function(t){return r.get(e.RootEntity).buttonState[t].value},getClick:n,getInputCommand:o,isClicked:function(e,t){return null!==n(e,t)},isTriggered:function(e,t,r){return null!==o(e,t,r)}}}function findLastAction(e,t,r,n){let i;for(const o of e)o.button===r&&o.state===t&&(!n||o.hit&&n===o.hit.entityId)&&(!i||o.timestamp>=i.timestamp)&&(i=o);return i}function checkNotThenable(e,t){return e}function preEngine(){const e=EntityContainer(),t=new Map,r=SystemContainer();function n(r){for(const[,e]of t)e.has(r)&&e.deleteFrom(r);return e.removeEntity(r)}function i(e,r,n){const i=t.get(r);if(i)return i;const o=defineComponent(r,e,n);return t.set(r,o),o}function*o(...e){for(const[t,...r]of function*(...e){const[t,...r]=e;for(const[n]of t.iterator()){let t=!0;for(const e of r)if(!e.has(n)){t=!1;break}t&&(yield[n,...e])}}(...e))yield[t,...r.map((e=>e.get(t)))]}const s=Transform$1({defineComponentFromSchema:i});function*a(e,t){if(!t.find((t=>e===t))){t.push(e);for(const[r,n]of o(s))n.parent===e&&(yield*a(r,t));yield e}}return{entityExists:function(t){return e.entityExists(t)},componentsDefinition:t,addEntity:function(){return e.generateEntity()},removeEntity:n,addSystem:function(e,t=SYSTEMS_REGULAR_PRIORITY,n){r.add(e,t,n)},getSystems:function(){return r.getSystems()},removeSystem:function(e){return r.remove(e)},defineComponent:function(e,t,r){return i(Schemas.Map(e),t,r)},defineComponentFromSchema:i,getEntitiesWith:o,getComponent:function(e){const r=t.get(e);if(!r)throw new Error(`Component ${e} not found. You need to declare the components at the beginnig of the engine declaration`);return r},getComponentOrNull:function(e){return t.get(e)??null},removeComponentDefinition:function(e){t.delete(e)},removeEntityWithChildren:function(e){for(const t of a(e,[]))n(t)},registerCustomComponent:function(e,r){if(t.get(r))throw new Error(`Component number ${r} was already registered.`);return t.set(r,e),e}}}function Engine(){const e=preEngine(),t=crdtSceneSystem(e);return{addEntity:e.addEntity,removeEntity:e.removeEntity,removeEntityWithChildren:e.removeEntityWithChildren,addSystem:e.addSystem,removeSystem:e.removeSystem,defineComponent:e.defineComponent,defineComponentFromSchema:e.defineComponentFromSchema,registerCustomComponent:e.registerCustomComponent,getEntitiesWith:e.getEntitiesWith,getComponent:e.getComponent,getComponentOrNull:e.getComponentOrNull,removeComponentDefinition:e.removeComponentDefinition,update:async function(r){await t.receiveMessages();for(const t of e.getSystems())t.fn(r);const n=new Map;for(const[t,r]of e.componentsDefinition)for(const e of r.dirtyIterator())n.has(e)||n.set(e,new Set),n.get(e).add(t);await t.createAndSendMessages(n);for(const[t,r]of e.componentsDefinition)r.clearDirty()},RootEntity:0,PlayerEntity:1,CameraEntity:2,entityExists:e.entityExists,addTransport:t.addTransport,getCrdtState:t.getCrdt}}function getAndClean(e){const t=Array.from(e);return e.length=0,t}function createTaskSystem(e){const t=[];async function r(e){try{return await e()}catch(e){console.error(e)}}return e.addSystem((function(){for(const e of getAndClean(t))r(e).catch(console.error)})),{executeTask(e){t.push(e)}}}function createPointerEventSystem(e,t){const r=PointerHoverFeedback(e);let n;!function(e){e[e.Click=0]="Click",e[e.Down=1]="Down",e[e.Up=2]="Up"}(n||(n={}));const i=(e={})=>({button:3,hoverText:"Interact",maxDistance:100,...e}),o=new Map;function s(e){return o.get(e)||o.set(e,new Map).get(e)}function a(e,t,n){if(n.hoverText){(r.getMutableOrNull(e)||r.create(e)).pointerEvents.push({eventType:t,eventInfo:{button:n.button,showFeedback:!0,hoverText:n.hoverText,maxDistance:n.maxDistance}})}}function u(e){return e===n.Up?0:1}function c(e,t){const n=s(e),i=n.get(t);i?.opts.hoverText&&function(e,t,n){const i=r.getMutableOrNull(e);i&&(i.pointerEvents=i.pointerEvents.filter((e=>!(e.eventInfo?.button===n&&e.eventType===t))))}(e,u(t),i.opts.button),n.delete(t)}return e.addSystem((function(){for(const[r,i]of o)if(e.entityExists(r))for(const[e,{cb:o,opts:s}]of i){if(e===n.Click){const e=t.getClick(s.button,r);e&&checkNotThenable(o(e.up))}if(e===n.Down||e===n.Up){const n=t.getInputCommand(s.button,u(e),r);n&&checkNotThenable(o(n))}}else o.delete(r)})),{removeOnClick(e){c(e,n.Click)},removeOnPointerDown(e){c(e,n.Down)},removeOnPointerUp(e){c(e,n.Up)},onClick(e,t,r){const o=i(r);c(e,n.Click),s(e).set(n.Click,{cb:t,opts:o}),a(e,1,o)},onPointerDown(e,t,r){const o=i(r);c(e,n.Down),s(e).set(n.Down,{cb:t,opts:o}),a(e,1,o)},onPointerUp(e,t,r){const o=i(r);c(e,n.Up),s(e).set(n.Up,{cb:t,opts:o}),a(e,0,o)}}}const engine=Engine(),inputSystem=createInputSystem(engine);createPointerEventSystem(engine,inputSystem),createTaskSystem(engine).executeTask;const Transform=Transform$1(engine);Animator(engine),Material(engine),MeshRenderer(engine),MeshCollider(engine);class ObserverEventState{constructor(e,t=!1,r,n){this.initalize(e,t,r,n)}initalize(e,t=!1,r,n){return this.mask=e,this.skipNextObservers=t,this.target=r,this.currentTarget=n,this}}class Observer{constructor(e,t,r=null){this.callback=e,this.mask=t,this.scope=r,this.unregisterOnNextCall=!1,this._willBeUnregistered=!1}}class Observable{constructor(e){this._observers=new Array,this._onObserverAdded=null,this._eventState=new ObserverEventState(0),e&&(this._onObserverAdded=e)}add(e,t=-1,r=!1,n=null,i=!1){if(!e)return null;const o=new Observer(e,t,n);return o.unregisterOnNextCall=i,r?this._observers.unshift(o):this._observers.push(o),this._onObserverAdded&&this._onObserverAdded(o),o}addOnce(e){return this.add(e,void 0,void 0,void 0,!0)}remove(e){if(!e)return!1;return-1!==this._observers.indexOf(e)&&(this._deferUnregister(e),!0)}removeCallback(e,t){for(let r=0;r<this._observers.length;r++)if(this._observers[r].callback===e&&(!t||t===this._observers[r].scope))return this._deferUnregister(this._observers[r]),!0;return!1}notifyObservers(e,t=-1,r,n){if(!this._observers.length)return!0;const i=this._eventState;i.mask=t,i.target=r,i.currentTarget=n,i.skipNextObservers=!1,i.lastReturnValue=e;for(const r of this._observers)if(!r._willBeUnregistered&&(r.mask&t&&(r.scope?i.lastReturnValue=r.callback.apply(r.scope,[e,i]):i.lastReturnValue=r.callback(e,i),r.unregisterOnNextCall&&this._deferUnregister(r)),i.skipNextObservers))return!1;return!0}notifyObserversWithPromise(e,t=-1,r,n){let i=Promise.resolve(e);if(!this._observers.length)return i;const o=this._eventState;return o.mask=t,o.target=r,o.currentTarget=n,o.skipNextObservers=!1,this._observers.forEach((r=>{o.skipNextObservers||r._willBeUnregistered||r.mask&t&&(i=r.scope?i.then((t=>(o.lastReturnValue=t,r.callback.apply(r.scope,[e,o])))):i.then((t=>(o.lastReturnValue=t,r.callback(e,o)))),r.unregisterOnNextCall&&this._deferUnregister(r))})),i.then((()=>e))}notifyObserver(e,t,r=-1){const n=this._eventState;n.mask=r,n.skipNextObservers=!1,e.callback(t,n)}hasObservers(){return this._observers.length>0}clear(){this._observers=new Array,this._onObserverAdded=null}clone(){const e=new Observable;return e._observers=this._observers.slice(0),e}hasSpecificMask(e=-1){for(const t of this._observers)if(t.mask&e||t.mask===e)return!0;return!1}_deferUnregister(e){e.unregisterOnNextCall=!1,e._willBeUnregistered=!0,Promise.resolve().then.bind(Promise.resolve())((async()=>this._remove(e))).catch(console.error)}_remove(e){if(!e)return!1;const t=this._observers.indexOf(e);return-1!==t&&(this._observers.splice(t,1),!0)}}let subscribeFunction=async()=>{};function createSubscriber(e){return()=>{subscribeFunction({eventId:e}).catch(console.error)}}const onEnterSceneObservable=new Observable(createSubscriber("onEnterScene")),onLeaveSceneObservable=new Observable(createSubscriber("onLeaveScene")),onSceneReadyObservable=new Observable(createSubscriber("sceneStart")),onPlayerExpressionObservable=new Observable(createSubscriber("playerExpression")),onVideoEvent=new Observable(createSubscriber("videoEvent")),onProfileChanged=new Observable(createSubscriber("profileChanged")),onPlayerConnectedObservable=new Observable(createSubscriber("playerConnected")),onPlayerDisconnectedObservable=new Observable(createSubscriber("playerDisconnected")),onRealmChangedObservable=new Observable(createSubscriber("onRealmChanged")),onPlayerClickedObservable=new Observable(createSubscriber("playerClicked"));function setSubscribeFunction(e){subscribeFunction=e}async function pollEvents(e){const{events:t}=await e({actions:[]});for(const e of t)if(e.generic){const t=JSON.parse(e.generic.eventData);switch(e.generic.eventId){case"onEnterScene":onEnterSceneObservable.notifyObservers(t);break;case"onLeaveScene":onLeaveSceneObservable.notifyObservers(t);break;case"sceneStart":onSceneReadyObservable.notifyObservers(t);break;case"playerExpression":onPlayerExpressionObservable.notifyObservers(t);break;case"videoEvent":{const e=t;onVideoEvent.notifyObservers(e);break}case"profileChanged":onProfileChanged.notifyObservers(t);break;case"playerConnected":onPlayerConnectedObservable.notifyObservers(t);break;case"playerDisconnected":onPlayerDisconnectedObservable.notifyObservers(t);break;case"onRealmChanged":onRealmChangedObservable.notifyObservers(t);break;case"playerClicked":onPlayerClickedObservable.notifyObservers(t)}}}var ECSComponentIDs;new Observable(createSubscriber("comms")),function(e){e[e.Transform=1]="Transform",e[e.Animator=1042]="Animator",e[e.AudioSource=1020]="AudioSource",e[e.AudioStream=1021]="AudioStream",e[e.AvatarAttach=1073]="AvatarAttach",e[e.AvatarModifierArea=1070]="AvatarModifierArea",e[e.AvatarShape=1080]="AvatarShape",e[e.Billboard=1090]="Billboard",e[e.CameraMode=1072]="CameraMode",e[e.CameraModeArea=1071]="CameraModeArea",e[e.GltfContainer=1041]="GltfContainer",e[e.Material=1017]="Material",e[e.MeshCollider=1019]="MeshCollider",e[e.MeshRenderer=1018]="MeshRenderer",e[e.NftShape=1040]="NftShape",e[e.PointerEventsResult=1063]="PointerEventsResult",e[e.PointerHoverFeedback=1062]="PointerHoverFeedback",e[e.PointerLock=1074]="PointerLock",e[e.Raycast=1067]="Raycast",e[e.RaycastResult=1068]="RaycastResult",e[e.TextShape=1030]="TextShape",e[e.UiBackground=1053]="UiBackground",e[e.UiText=1052]="UiText",e[e.UiTransform=1050]="UiTransform",e[e.VisibilityComponent=1081]="VisibilityComponent"}(ECSComponentIDs||(ECSComponentIDs={}));const componentIds=Object.values(ECSComponentIDs).filter((e=>"number"==typeof e)).map(Number);function createRendererTransport(e){const t="renderer",r={type:t,async send(t){try{await async function(t){const n=await e.crdtSendToRenderer({data:new Uint8Array(t)});if(n&&n.data&&n.data.length&&r.onmessage)for(const e of n.data)r.onmessage(e)}(t)}catch(e){console.error(e)}},filter:e=>e.transportType!==t&&(!!componentIds.includes(e.componentId)&&!!e)};return r}async function onUpdate(e){await engine.update(e),await pollEvents(EngineApi.sendBatch)}engine.addTransport(createRendererTransport({crdtSendToRenderer:EngineApi.crdtSendToRenderer})),setSubscribeFunction(EngineApi.subscribe);const cube=engine.addEntity();Transform.create(cube),exports.onUpdate=onUpdate;